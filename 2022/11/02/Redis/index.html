<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Redisç¬”è®° | Decap-BlogğŸ¥</title><meta name="author" content="AXDecap"><meta name="copyright" content="AXDecap"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Redis1ã€å®‰è£…https:&#x2F;&#x2F;registry.hub.docker.com&#x2F;_&#x2F;redis  å‡†å¤‡ redis.conf  ä»å®˜ç½‘ä¸‹è½½redis.confæ–‡ä»¶ï¼Œç‚¹å‡»è¶…é“¾æ¥ä¸‹è½½ rediså®˜ç½‘ï¼šhttps:&#x2F;&#x2F;redis.io&#x2F; è¿›å…¥å®˜ç½‘ï¼Œç›´æ¥ä¸‹è½½ redis-xxx.tar.gzï¼Œç„¶åè§£å‹ä¹Ÿå¯ä»¥å¾—åˆ°redis.conf å°†redis.confæ”¾åœ¨æœ¬åœ°çš„ä¸€ä¸ªç›®å½•,æ¯”å¦‚: D:&#x2F;red">
<meta property="og:type" content="article">
<meta property="og:title" content="Redisç¬”è®°">
<meta property="og:url" content="http://example.com/2022/11/02/Redis/index.html">
<meta property="og:site_name" content="Decap-BlogğŸ¥">
<meta property="og:description" content="Redis1ã€å®‰è£…https:&#x2F;&#x2F;registry.hub.docker.com&#x2F;_&#x2F;redis  å‡†å¤‡ redis.conf  ä»å®˜ç½‘ä¸‹è½½redis.confæ–‡ä»¶ï¼Œç‚¹å‡»è¶…é“¾æ¥ä¸‹è½½ rediså®˜ç½‘ï¼šhttps:&#x2F;&#x2F;redis.io&#x2F; è¿›å…¥å®˜ç½‘ï¼Œç›´æ¥ä¸‹è½½ redis-xxx.tar.gzï¼Œç„¶åè§£å‹ä¹Ÿå¯ä»¥å¾—åˆ°redis.conf å°†redis.confæ”¾åœ¨æœ¬åœ°çš„ä¸€ä¸ªç›®å½•,æ¯”å¦‚: D:&#x2F;red">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gcore.jsdelivr.net/gh/AXDecap/imagehost/img/mmexport1652792137012.jpg">
<meta property="article:published_time" content="2022-11-02T15:00:00.000Z">
<meta property="article:modified_time" content="2022-11-02T15:00:00.000Z">
<meta property="article:author" content="AXDecap">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gcore.jsdelivr.net/gh/AXDecap/imagehost/img/mmexport1652792137012.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/11/02/Redis/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redisç¬”è®°',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-02 23:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/AXDecap/imagehost/img/1.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">1</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> ç•™è¨€æ¿</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://gcore.jsdelivr.net/gh/AXDecap/imagehost/img/mmexport1652792137012.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Decap-BlogğŸ¥</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> ç•™è¨€æ¿</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Redisç¬”è®°</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-11-02T15:00:00.000Z" title="Created 2022-11-02 23:00:00">2022-11-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-11-02T15:00:00.000Z" title="Updated 2022-11-02 23:00:00">2022-11-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">17.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>62min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Redisç¬”è®°"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="1ã€å®‰è£…"><a href="#1ã€å®‰è£…" class="headerlink" title="1ã€å®‰è£…"></a>1ã€å®‰è£…</h3><p><a target="_blank" rel="noopener" href="https://registry.hub.docker.com/_/redis">https://registry.hub.docker.com/_/redis</a></p>
<ol>
<li><strong>å‡†å¤‡ redis.conf</strong></li>
</ol>
<p>ä»å®˜ç½‘ä¸‹è½½<a href="https://link.juejin.cn/?target=http://download.redis.io/redis-stable/redis.conf">redis.conf</a>æ–‡ä»¶ï¼Œç‚¹å‡»è¶…é“¾æ¥ä¸‹è½½</p>
<p>rediså®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/</a></p>
<p>è¿›å…¥å®˜ç½‘ï¼Œç›´æ¥ä¸‹è½½ redis-xxx.tar.gzï¼Œç„¶åè§£å‹ä¹Ÿå¯ä»¥å¾—åˆ°redis.conf</p>
<p>å°†redis.confæ”¾åœ¨æœ¬åœ°çš„ä¸€ä¸ªç›®å½•,æ¯”å¦‚: D:&#x2F;redis. å¹¶å¯¹æ–‡ä»¶åšä¸€ä¸‹ä¿®æ”¹:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bind 127.0.0.1 #æ³¨é‡Šæ‰è¿™éƒ¨åˆ†ï¼Œè¿™æ˜¯é™åˆ¶redisåªèƒ½æœ¬åœ°è®¿é—®</span><br><span class="line">protected-mode no #é»˜è®¤yesï¼Œå¼€å¯ä¿æŠ¤æ¨¡å¼ï¼Œé™åˆ¶ä¸ºæœ¬åœ°è®¿é—®</span><br><span class="line">daemonize no#é»˜è®¤noï¼Œæ”¹ä¸ºyesæ„ä¸ºä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼å¯åŠ¨ï¼Œå¯åå°è¿è¡Œï¼Œé™¤ékillè¿›ç¨‹ï¼Œæ”¹ä¸ºyesä¼šä½¿é…ç½®æ–‡ä»¶æ–¹å¼å¯åŠ¨rediså¤±è´¥</span><br><span class="line">databases 16 #æ•°æ®åº“ä¸ªæ•°ï¼ˆå¯é€‰ï¼‰ï¼Œæˆ‘ä¿®æ”¹äº†è¿™ä¸ªåªæ˜¯æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆã€‚ã€‚</span><br><span class="line">dir  ./ #è¾“å…¥æœ¬åœ°redisæ•°æ®åº“å­˜æ”¾æ–‡ä»¶å¤¹ï¼ˆå¯é€‰ï¼‰</span><br><span class="line">appendonly yes #redisæŒä¹…åŒ–ï¼ˆå¯é€‰ï¼‰</span><br><span class="line">requirepass  å¯†ç  #é…ç½®redisè®¿é—®å¯†ç </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ‹‰å–é•œåƒ</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker search redis</span><br><span class="line">docker pull redis</span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åœ¨D:&#x2F;redisç›®å½•ä¸‹é¢æ–°å»ºdataç›®å½•,ç”¨äºå­˜å‚¨redisæ•°æ®</li>
<li>å¯åŠ¨redisé•œåƒ(é…ç½®å’Œæ•°æ®æ˜ å°„åˆ°æœ¬åœ°)</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -dit --name redis-server -p 6379:6379 -v D:\Software\Redis\conf:/etc/redis -v D:\Software\Redis\data:/data redis:latest redis-server /etc/redis/redis.conf --appendonly yes --requirepass &quot;123456&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ps: ä¸Šé¢çš„å‘½ä»¤é‡Œé¢,ç¬¬ä¸€ä¸ª<code>-v</code>æ˜¯å°†redis.confæ˜ å°„åˆ°dockerçš„redisé…ç½®,ç¬¬äºŒä¸ª<code>-v</code>æ˜¯å°†rediså­˜å‚¨æ•°æ®åšæ˜ å°„.è¿™é‡Œ<code>:</code>å‰é¢çš„è·¯å¾„éƒ½æ˜¯æœ¬åœ°çš„è·¯å¾„,ä¸è¦å¼„é”™äº†</p>
<p>redis-server &#x2F;etc&#x2F;redis&#x2F;redis.confï¼šæŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤</p>
<p>â€“appendonly yes å¼€å¯æ•°æ®æŒä¹…åŒ–,</p>
<p> â€“requirepass â€œ123456â€ æŒ‡å®šå¯†ç </p>
<p>è¿™äº›é…ç½®å›è¢«è®°å½•åœ¨å®¹å™¨å†…éƒ¨docker inspect å®¹å™¨åæŸ¥çœ‹</p>
<p>å®éªŒå‘ç°, å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¿®æ”¹è¿™äº›é…ç½®ï¼Œé‡å¯redisåä¾ç„¶ä¸ä¼šç”Ÿæ•ˆï¼Œåªæœ‰åœ¨å¯åŠ¨æ—¶ä¸åŠ è¿™äº›å‚æ•°ï¼Œæ‰ä¼šæœ‰æ•ˆ</p>
</blockquote>
<ol start="5">
<li>æŸ¥çœ‹</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker exec -it redis-server /bin/bash</span><br><span class="line">redis-cli -a 123456</span><br></pre></td></tr></table></figure>

<h3 id="2ã€é…ç½®"><a href="#2ã€é…ç½®" class="headerlink" title="2ã€é…ç½®"></a>2ã€é…ç½®</h3><p>Redis çš„é…ç½®æ–‡ä»¶ä½äº Redis å®‰è£…ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸º <strong>redis.conf</strong>(Windows åä¸º redis.windows.conf)ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ <strong>CONFIG</strong> å‘½ä»¤æŸ¥çœ‹æˆ–è®¾ç½®é…ç½®é¡¹ã€‚</p>
<p>è¯­æ³•</p>
<p>Redis CONFIG å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; CONFIG GET CONFIG_SETTING_NAME</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ ***** å·è·å–æ‰€æœ‰é…ç½®é¡¹ï¼š</p>
<p><strong>ç¼–è¾‘é…ç½®</strong></p>
<p>ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹ redis.conf æ–‡ä»¶æˆ–ä½¿ç”¨ <strong>CONFIG set</strong> å‘½ä»¤æ¥ä¿®æ”¹é…ç½®ã€‚</p>
<p>è¯­æ³•</p>
<p><strong>CONFIG SET</strong> å‘½ä»¤åŸºæœ¬è¯­æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; CONFIG SET CONFIG_SETTING_NAME NEW_CONFIG_VALUE</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜</strong></p>
<p>redis.conf é…ç½®é¡¹è¯´æ˜å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">é…ç½®é¡¹</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><code>daemonize no</code></td>
<td align="left">Redis é»˜è®¤ä¸æ˜¯ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œå¯ä»¥é€šè¿‡è¯¥é…ç½®é¡¹ä¿®æ”¹ï¼Œä½¿ç”¨ yes å¯ç”¨å®ˆæŠ¤è¿›ç¨‹ï¼ˆWindows ä¸æ”¯æŒå®ˆæŠ¤çº¿ç¨‹çš„é…ç½®ä¸º no ï¼‰</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><code>pidfile /var/run/redis.pid</code></td>
<td align="left">å½“ Redis ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼ŒRedis é»˜è®¤ä¼šæŠŠ pid å†™å…¥ &#x2F;var&#x2F;run&#x2F;redis.pid æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ pidfile æŒ‡å®š</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><code>port 6379</code></td>
<td align="left">æŒ‡å®š Redis ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º 6379ï¼Œä½œè€…åœ¨è‡ªå·±çš„ä¸€ç¯‡åšæ–‡ä¸­è§£é‡Šäº†ä¸ºä»€ä¹ˆé€‰ç”¨ 6379 ä½œä¸ºé»˜è®¤ç«¯å£ï¼Œå› ä¸º 6379 åœ¨æ‰‹æœºæŒ‰é”®ä¸Š MERZ å¯¹åº”çš„å·ç ï¼Œè€Œ MERZ å–è‡ªæ„å¤§åˆ©æ­Œå¥³ Alessia Merz çš„åå­—</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><code>bind 127.0.0.1</code></td>
<td align="left"><strong>ç»‘å®šçš„ä¸»æœºåœ°å€</strong>ï¼Œé»˜è®¤åªæœ‰æœ¬åœ°å¯ä»¥è®¿é—®</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><code>timeout 300</code></td>
<td align="left">å½“å®¢æˆ·ç«¯é—²ç½®å¤šé•¿ç§’åå…³é—­è¿æ¥ï¼Œå¦‚æœæŒ‡å®šä¸º 0 ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><code>loglevel notice</code></td>
<td align="left">æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedis æ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸º notice</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><code>logfile stdout</code></td>
<td align="left">æ—¥å¿—è®°å½•æ–¹å¼ï¼Œé»˜è®¤ä¸ºæ ‡å‡†è¾“å‡ºï¼Œå¦‚æœé…ç½® Redis ä¸ºå®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œï¼Œè€Œè¿™é‡Œåˆé…ç½®ä¸ºæ—¥å¿—è®°å½•æ–¹å¼ä¸ºæ ‡å‡†è¾“å‡ºï¼Œåˆ™æ—¥å¿—å°†ä¼šå‘é€ç»™ &#x2F;dev&#x2F;null</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><code>databases 16</code></td>
<td align="left">è®¾ç½®æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ï¼Œå¯ä»¥ä½¿ç”¨SELECT å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“id</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><code>save &lt;seconds&gt; &lt;changes&gt;</code>Redis é»˜è®¤é…ç½®æ–‡ä»¶ä¸­æä¾›äº†ä¸‰ä¸ªæ¡ä»¶ï¼š<strong>save 900 1<strong><strong>save 300 10</strong></strong>save 60 10000</strong>åˆ†åˆ«è¡¨ç¤º 900 ç§’ï¼ˆ15 åˆ†é’Ÿï¼‰å†…æœ‰ 1 ä¸ªæ›´æ”¹ï¼Œ300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰å†…æœ‰ 10 ä¸ªæ›´æ”¹ä»¥åŠ 60 ç§’å†…æœ‰ 10000 ä¸ªæ›´æ”¹ã€‚</td>
<td align="left">æŒ‡å®šåœ¨å¤šé•¿æ—¶é—´å†…ï¼Œæœ‰å¤šå°‘æ¬¡æ›´æ–°æ“ä½œï¼Œå°±å°†æ•°æ®åŒæ­¥åˆ°æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥å¤šä¸ªæ¡ä»¶é…åˆ</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><code>rdbcompression yes</code></td>
<td align="left">æŒ‡å®šå­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ•°æ®ï¼Œé»˜è®¤ä¸º yesï¼ŒRedis é‡‡ç”¨ LZF å‹ç¼©ï¼Œå¦‚æœä¸ºäº†èŠ‚çœ CPU æ—¶é—´ï¼Œå¯ä»¥å…³é—­è¯¥é€‰é¡¹ï¼Œä½†ä¼šå¯¼è‡´æ•°æ®åº“æ–‡ä»¶å˜çš„å·¨å¤§</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><code>dbfilename dump.rdb</code></td>
<td align="left">æŒ‡å®šæœ¬åœ°æ•°æ®åº“æ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸º dump.rdb</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><code>dir ./</code></td>
<td align="left">æŒ‡å®šæœ¬åœ°æ•°æ®åº“å­˜æ”¾ç›®å½•</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><code>slaveof &lt;masterip&gt; &lt;masterport&gt;</code></td>
<td align="left">è®¾ç½®å½“æœ¬æœºä¸º slave æœåŠ¡æ—¶ï¼Œè®¾ç½® master æœåŠ¡çš„ IP åœ°å€åŠç«¯å£ï¼Œåœ¨ Redis å¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä» master è¿›è¡Œæ•°æ®åŒæ­¥</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><code>masterauth &lt;master-password&gt;</code></td>
<td align="left">å½“ master æœåŠ¡è®¾ç½®äº†å¯†ç ä¿æŠ¤æ—¶ï¼Œslave æœåŠ¡è¿æ¥ master çš„å¯†ç </td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><code>requirepass foobared</code></td>
<td align="left">è®¾ç½® Redis è¿æ¥å¯†ç ï¼Œå¦‚æœé…ç½®äº†è¿æ¥å¯†ç ï¼Œå®¢æˆ·ç«¯åœ¨è¿æ¥ Redis æ—¶éœ€è¦é€šè¿‡ AUTH <password> å‘½ä»¤æä¾›å¯†ç ï¼Œé»˜è®¤å…³é—­</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><code> maxclients 128</code></td>
<td align="left">è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤æ— é™åˆ¶ï¼ŒRedis å¯ä»¥åŒæ—¶æ‰“å¼€çš„å®¢æˆ·ç«¯è¿æ¥æ•°ä¸º Redis è¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°ï¼Œå¦‚æœè®¾ç½® maxclients 0ï¼Œè¡¨ç¤ºä¸ä½œé™åˆ¶ã€‚å½“å®¢æˆ·ç«¯è¿æ¥æ•°åˆ°è¾¾é™åˆ¶æ—¶ï¼ŒRedis ä¼šå…³é—­æ–°çš„è¿æ¥å¹¶å‘å®¢æˆ·ç«¯è¿”å› max number of clients reached é”™è¯¯ä¿¡æ¯</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><code>maxmemory &lt;bytes&gt;</code></td>
<td align="left">æŒ‡å®š Redis æœ€å¤§å†…å­˜é™åˆ¶ï¼ŒRedis åœ¨å¯åŠ¨æ—¶ä¼šæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¾¾åˆ°æœ€å¤§å†…å­˜åï¼ŒRedis ä¼šå…ˆå°è¯•æ¸…é™¤å·²åˆ°æœŸæˆ–å³å°†åˆ°æœŸçš„ Keyï¼Œå½“æ­¤æ–¹æ³•å¤„ç† åï¼Œä»ç„¶åˆ°è¾¾æœ€å¤§å†…å­˜è®¾ç½®ï¼Œå°†æ— æ³•å†è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†ä»ç„¶å¯ä»¥è¿›è¡Œè¯»å–æ“ä½œã€‚Redis æ–°çš„ vm æœºåˆ¶ï¼Œä¼šæŠŠ Key å­˜æ”¾å†…å­˜ï¼ŒValue ä¼šå­˜æ”¾åœ¨ swap åŒº</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left"><code>appendonly no</code></td>
<td align="left">æŒ‡å®šæ˜¯å¦åœ¨æ¯æ¬¡æ›´æ–°æ“ä½œåè¿›è¡Œæ—¥å¿—è®°å½•ï¼ŒRedis åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥çš„æŠŠæ•°æ®å†™å…¥ç£ç›˜ï¼Œå¦‚æœä¸å¼€å¯ï¼Œå¯èƒ½ä¼šåœ¨æ–­ç”µæ—¶å¯¼è‡´ä¸€æ®µæ—¶é—´å†…çš„æ•°æ®ä¸¢å¤±ã€‚å› ä¸º redis æœ¬èº«åŒæ­¥æ•°æ®æ–‡ä»¶æ˜¯æŒ‰ä¸Šé¢ save æ¡ä»¶æ¥åŒæ­¥çš„ï¼Œæ‰€ä»¥æœ‰çš„æ•°æ®ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…åªå­˜åœ¨äºå†…å­˜ä¸­ã€‚é»˜è®¤ä¸º no</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left"><code>appendfilename appendonly.aof</code></td>
<td align="left">æŒ‡å®šæ›´æ–°æ—¥å¿—æ–‡ä»¶åï¼Œé»˜è®¤ä¸º appendonly.aof</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left"><code>appendfsync everysec</code></td>
<td align="left">æŒ‡å®šæ›´æ–°æ—¥å¿—æ¡ä»¶ï¼Œå…±æœ‰ 3 ä¸ªå¯é€‰å€¼ï¼š<strong>no</strong>ï¼šè¡¨ç¤ºç­‰æ“ä½œç³»ç»Ÿè¿›è¡Œæ•°æ®ç¼“å­˜åŒæ­¥åˆ°ç£ç›˜ï¼ˆå¿«ï¼‰<strong>always</strong>ï¼šè¡¨ç¤ºæ¯æ¬¡æ›´æ–°æ“ä½œåæ‰‹åŠ¨è°ƒç”¨ fsync() å°†æ•°æ®å†™åˆ°ç£ç›˜ï¼ˆæ…¢ï¼Œå®‰å…¨ï¼‰<strong>everysec</strong>ï¼šè¡¨ç¤ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼ˆæŠ˜ä¸­ï¼Œé»˜è®¤å€¼ï¼‰</td>
</tr>
<tr>
<td align="left">21</td>
<td align="left"><code>vm-enabled no</code></td>
<td align="left">æŒ‡å®šæ˜¯å¦å¯ç”¨è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼Œé»˜è®¤å€¼ä¸º noï¼Œç®€å•çš„ä»‹ç»ä¸€ä¸‹ï¼ŒVM æœºåˆ¶å°†æ•°æ®åˆ†é¡µå­˜æ”¾ï¼Œç”± Redis å°†è®¿é—®é‡è¾ƒå°‘çš„é¡µå³å†·æ•°æ® swap åˆ°ç£ç›˜ä¸Šï¼Œè®¿é—®å¤šçš„é¡µé¢ç”±ç£ç›˜è‡ªåŠ¨æ¢å‡ºåˆ°å†…å­˜ä¸­ï¼ˆåœ¨åé¢çš„æ–‡ç« æˆ‘ä¼šä»”ç»†åˆ†æ Redis çš„ VM æœºåˆ¶ï¼‰</td>
</tr>
<tr>
<td align="left">22</td>
<td align="left"><code>vm-swap-file /tmp/redis.swap</code></td>
<td align="left">è™šæ‹Ÿå†…å­˜æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º &#x2F;tmp&#x2F;redis.swapï¼Œä¸å¯å¤šä¸ª Redis å®ä¾‹å…±äº«</td>
</tr>
<tr>
<td align="left">23</td>
<td align="left"><code>vm-max-memory 0</code></td>
<td align="left">å°†æ‰€æœ‰å¤§äº vm-max-memory çš„æ•°æ®å­˜å…¥è™šæ‹Ÿå†…å­˜ï¼Œæ— è®º vm-max-memory è®¾ç½®å¤šå°ï¼Œæ‰€æœ‰ç´¢å¼•æ•°æ®éƒ½æ˜¯å†…å­˜å­˜å‚¨çš„(Redis çš„ç´¢å¼•æ•°æ® å°±æ˜¯ keys)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ vm-max-memory è®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œå…¶å®æ˜¯æ‰€æœ‰ value éƒ½å­˜åœ¨äºç£ç›˜ã€‚é»˜è®¤å€¼ä¸º 0</td>
</tr>
<tr>
<td align="left">24</td>
<td align="left"><code>vm-page-size 32</code></td>
<td align="left">Redis swap æ–‡ä»¶åˆ†æˆäº†å¾ˆå¤šçš„ pageï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥ä¿å­˜åœ¨å¤šä¸ª page ä¸Šé¢ï¼Œä½†ä¸€ä¸ª page ä¸Šä¸èƒ½è¢«å¤šä¸ªå¯¹è±¡å…±äº«ï¼Œvm-page-size æ˜¯è¦æ ¹æ®å­˜å‚¨çš„ æ•°æ®å¤§å°æ¥è®¾å®šçš„ï¼Œä½œè€…å»ºè®®å¦‚æœå­˜å‚¨å¾ˆå¤šå°å¯¹è±¡ï¼Œpage å¤§å°æœ€å¥½è®¾ç½®ä¸º 32 æˆ–è€… 64bytesï¼›å¦‚æœå­˜å‚¨å¾ˆå¤§å¤§å¯¹è±¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ›´å¤§çš„ pageï¼Œå¦‚æœä¸ç¡®å®šï¼Œå°±ä½¿ç”¨é»˜è®¤å€¼</td>
</tr>
<tr>
<td align="left">25</td>
<td align="left"><code>vm-pages 134217728</code></td>
<td align="left">è®¾ç½® swap æ–‡ä»¶ä¸­çš„ page æ•°é‡ï¼Œç”±äºé¡µè¡¨ï¼ˆä¸€ç§è¡¨ç¤ºé¡µé¢ç©ºé—²æˆ–ä½¿ç”¨çš„ bitmapï¼‰æ˜¯åœ¨æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œï¼Œåœ¨ç£ç›˜ä¸Šæ¯ 8 ä¸ª pages å°†æ¶ˆè€— 1byte çš„å†…å­˜ã€‚</td>
</tr>
<tr>
<td align="left">26</td>
<td align="left"><code>vm-max-threads 4</code></td>
<td align="left">è®¾ç½®è®¿é—®swapæ–‡ä»¶çš„çº¿ç¨‹æ•°,æœ€å¥½ä¸è¦è¶…è¿‡æœºå™¨çš„æ ¸æ•°,å¦‚æœè®¾ç½®ä¸º0,é‚£ä¹ˆæ‰€æœ‰å¯¹swapæ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„ï¼Œå¯èƒ½ä¼šé€ æˆæ¯”è¾ƒé•¿æ—¶é—´çš„å»¶è¿Ÿã€‚é»˜è®¤å€¼ä¸º4</td>
</tr>
<tr>
<td align="left">27</td>
<td align="left"><code>glueoutputbuf yes</code></td>
<td align="left">è®¾ç½®åœ¨å‘å®¢æˆ·ç«¯åº”ç­”æ—¶ï¼Œæ˜¯å¦æŠŠè¾ƒå°çš„åŒ…åˆå¹¶ä¸ºä¸€ä¸ªåŒ…å‘é€ï¼Œé»˜è®¤ä¸ºå¼€å¯</td>
</tr>
<tr>
<td align="left">28</td>
<td align="left"><code>hash-max-zipmap-entries 64 hash-max-zipmap-value 512</code></td>
<td align="left">æŒ‡å®šåœ¨è¶…è¿‡ä¸€å®šçš„æ•°é‡æˆ–è€…æœ€å¤§çš„å…ƒç´ è¶…è¿‡æŸä¸€ä¸´ç•Œå€¼æ—¶ï¼Œé‡‡ç”¨ä¸€ç§ç‰¹æ®Šçš„å“ˆå¸Œç®—æ³•</td>
</tr>
<tr>
<td align="left">29</td>
<td align="left"><code>activerehashing yes</code></td>
<td align="left">æŒ‡å®šæ˜¯å¦æ¿€æ´»é‡ç½®å“ˆå¸Œï¼Œé»˜è®¤ä¸ºå¼€å¯ï¼ˆåé¢åœ¨ä»‹ç» Redis çš„å“ˆå¸Œç®—æ³•æ—¶å…·ä½“ä»‹ç»ï¼‰</td>
</tr>
<tr>
<td align="left">30</td>
<td align="left"><code>include /path/to/local.conf</code></td>
<td align="left">æŒ‡å®šåŒ…å«å…¶å®ƒçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸»æœºä¸Šå¤šä¸ªRediså®ä¾‹ä¹‹é—´ä½¿ç”¨åŒä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œè€ŒåŒæ—¶å„ä¸ªå®ä¾‹åˆæ‹¥æœ‰è‡ªå·±çš„ç‰¹å®šé…ç½®æ–‡ä»¶</td>
</tr>
</tbody></table>
<h3 id="3ã€å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹"><a href="#3ã€å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹" class="headerlink" title="3ã€å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹"></a>3ã€å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹</h3><p>rediså¸¸è§æ•°æ®ç±»å‹æ“ä½œå‘½ä»¤<a target="_blank" rel="noopener" href="http://www.redis.cn/commands.html">http://www.redis.cn/commands.html</a></p>
<p>Redis æ•°æ®åº“æ”¯æŒäº”ç§æ•°æ®ç±»å‹ã€‚</p>
<ul>
<li>å­—ç¬¦ä¸²ï¼ˆstringï¼‰</li>
<li>å“ˆå¸Œï¼ˆhashï¼‰</li>
<li>åˆ—è¡¨ï¼ˆlistï¼‰</li>
<li>é›†åˆï¼ˆsetï¼‰</li>
<li>æœ‰åºé›†åˆï¼ˆsorted setï¼‰</li>
<li>ä½å›¾ ( Bitmaps )</li>
<li>åŸºæ•°ç»Ÿè®¡ ( HyperLogLogs )</li>
</ul>
<h4 id="2-1å‘½ä»¤"><a href="#2-1å‘½ä»¤" class="headerlink" title="2.1å‘½ä»¤"></a>2.1å‘½ä»¤</h4><p>è¦åœ¨ redis æœåŠ¡ä¸Šæ‰§è¡Œå‘½ä»¤éœ€è¦ä¸€ä¸ª redis å®¢æˆ·ç«¯ã€‚Redis å®¢æˆ·ç«¯åœ¨æˆ‘ä»¬ä¹‹å‰ä¸‹è½½çš„çš„ redis çš„å®‰è£…åŒ…ä¸­ã€‚</p>
<p>è¯­æ³•</p>
<p>Redis å®¢æˆ·ç«¯çš„åŸºæœ¬è¯­æ³•ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli</span><br></pre></td></tr></table></figure>

<p>å®ä¾‹</p>
<p>ä»¥ä¸‹å®ä¾‹è®²è§£äº†å¦‚ä½•å¯åŠ¨ redis å®¢æˆ·ç«¯ï¼š</p>
<p>å¯åŠ¨ redis æœåŠ¡å™¨ï¼Œæ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥å‘½ä»¤ <strong>redis-cli</strong>ï¼Œè¯¥å‘½ä»¤ä¼šè¿æ¥æœ¬åœ°çš„ redis æœåŠ¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br><span class="line">redis 127.0.0.1:6379&gt; PING</span><br><span class="line"></span><br><span class="line">PONG</span><br></pre></td></tr></table></figure>

<p>åœ¨ä»¥ä¸Šå®ä¾‹ä¸­æˆ‘ä»¬è¿æ¥åˆ°æœ¬åœ°çš„ redis æœåŠ¡å¹¶æ‰§è¡Œ <strong>PING</strong> å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ç”¨äºæ£€æµ‹ redis æœåŠ¡æ˜¯å¦å¯åŠ¨ã€‚</p>
<p>åœ¨è¿œç¨‹æœåŠ¡ä¸Šæ‰§è¡Œå‘½ä»¤</p>
<p>å¦‚æœéœ€è¦åœ¨è¿œç¨‹ redis æœåŠ¡ä¸Šæ‰§è¡Œå‘½ä»¤ï¼ŒåŒæ ·æˆ‘ä»¬ä½¿ç”¨çš„ä¹Ÿæ˜¯ <strong>redis-cli</strong> å‘½ä»¤ã€‚</p>
<p>è¯­æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -h host -p port -a password</span><br></pre></td></tr></table></figure>

<p>å®ä¾‹</p>
<p>ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº†å¦‚ä½•è¿æ¥åˆ°ä¸»æœºä¸º 127.0.0.1ï¼Œç«¯å£ä¸º 6379 ï¼Œå¯†ç ä¸º mypass çš„ redis æœåŠ¡ä¸Šã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$redis-cli -h 127.0.0.1 -p 6379 -a &quot;mypass&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br><span class="line">redis 127.0.0.1:6379&gt; PING</span><br><span class="line"></span><br><span class="line">PONG</span><br></pre></td></tr></table></figure>

<h4 id="2-2é”®"><a href="#2-2é”®" class="headerlink" title="2.2é”®"></a>2.2é”®</h4><ul>
<li>keys * æŸ¥çœ‹å½“å‰åº“æ‰€æœ‰key</li>
<li>exists key åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</li>
<li>type key æŸ¥çœ‹keyæ˜¯ä»€ä¹ˆç±»å‹</li>
<li>del key åˆ é™¤æŒ‡å®šçš„keyæ•°æ®</li>
<li>unlink key åˆ é™¤æŒ‡å®šçš„keyï¼Œè¯¥å‘½ä»¤ä¼šæ‰§è¡Œå‘½ä»¤ä¹‹å¤–çš„çº¿ç¨‹ä¸­æ‰§è¡Œå®é™…çš„å†…å­˜å›æ”¶ï¼Œå› æ­¤å®ƒä¸æ˜¯é˜»å¡ï¼Œè€Œ <a target="_blank" rel="noopener" href="https://www.redis.com.cn/commands/del.html">DEL</a> æ˜¯é˜»å¡çš„ï¼Œä»…å°†keysä»keyspaceå…ƒæ•°æ®ä¸­åˆ é™¤ï¼ŒçœŸæ­£çš„åˆ é™¤ä¼šåœ¨åç»­å¼‚æ­¥æ“ä½œã€‚</li>
<li>expire key 10 10s ä¸ºç»™å®šçš„keyè®¾ç½®å›½ä¼æ—¶é—´</li>
<li>ttl key æŸ¥çœ‹è¿˜æœ‰å¤šå°‘ç§’è¿‡æœŸï¼Œ-1è¡¨ç¤ºæ°¸ä¹…ä¸è¿‡æœŸï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸï¼Œé»˜è®¤æ˜¯å®¹ä¸è¿‡æœŸ</li>
</ul>
<h4 id="2-1å­—ç¬¦ä¸²"><a href="#2-1å­—ç¬¦ä¸²" class="headerlink" title="2.1å­—ç¬¦ä¸²"></a>2.1å­—ç¬¦ä¸²</h4><p>string æ˜¯ redis æœ€åŸºæœ¬çš„ç±»å‹ï¼Œä½ å¯ä»¥ç†è§£æˆä¸ Memcached ä¸€æ¨¡ä¸€æ ·çš„ç±»å‹ï¼Œä¸€ä¸ª key å¯¹åº”ä¸€ä¸ª valueã€‚</p>
<p>string ç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„æ€æ˜¯ redis çš„ string å¯ä»¥åŒ…å«<strong>ä»»ä½•æ•°æ®</strong>ã€‚æ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚</p>
<p>string ç±»å‹æ˜¯ Redis æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œstring ç±»å‹çš„å€¼æœ€å¤§èƒ½å­˜å‚¨ 512MBã€‚åŠ¨æ€æ‰©å®¹</p>
<p><strong>å¸¸ç”¨å‘½ä»¤</strong></p>
<p>ä¸‹è¡¨åˆ—å‡ºäº†å¸¸ç”¨çš„ redis å­—ç¬¦ä¸²å‘½ä»¤ï¼š</p>
<table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">å‘½ä»¤åŠæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-set.html">SET key value</a> è®¾ç½®æŒ‡å®š key çš„å€¼ã€‚</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-get.html">GET key</a> è·å–æŒ‡å®š key çš„å€¼ã€‚</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>MSET key value [key value â€¦]</strong> åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ã€‚</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>MGET key1 [key2..]</strong> è·å–æ‰€æœ‰(ä¸€ä¸ªæˆ–å¤šä¸ª)ç»™å®š key çš„å€¼ã€‚</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-strlen.html"><strong>STRLEN key</strong></a> è¿”å› key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼çš„é•¿åº¦ã€‚</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-incr.html"><strong>INCR key</strong></a> å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ã€‚</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-decr.html"><strong>DECR key</strong></a> å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡ä¸€ã€‚</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-incrby.html">INCRBY key increment</a> å°† key æ‰€å‚¨å­˜çš„å€¼åŠ ä¸Šç»™å®šçš„å¢é‡å€¼ï¼ˆincrementï¼‰ ã€‚</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-decrby.html">DECRBY key decrement</a> key æ‰€å‚¨å­˜çš„å€¼å‡å»ç»™å®šçš„å‡é‡å€¼ï¼ˆdecrementï¼‰ ã€‚</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-getset.html">GETSET key value</a> å°†ç»™å®š key çš„å€¼è®¾ä¸º value ï¼Œå¹¶è¿”å› key çš„æ—§å€¼(old value)ã€‚</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-setbit.html">SETBIT key offset value</a> å¯¹ key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè®¾ç½®æˆ–æ¸…é™¤æŒ‡å®šåç§»é‡ä¸Šçš„ä½(bit)ã€‚<strong>è¿™ä¸¤ä¸ªåœ¨bitmapä¸­ä½¿ç”¨</strong></td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-getbit.html">GETBIT key offset</a> å¯¹ key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè·å–æŒ‡å®šåç§»é‡ä¸Šçš„ä½(bit)ã€‚</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-setex.html">SETEX key seconds value</a> å°†å€¼ value å…³è”åˆ° key ï¼Œå¹¶å°† key çš„è¿‡æœŸæ—¶é—´è®¾ä¸º seconds (ä»¥ç§’ä¸ºå•ä½)ã€‚</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-setnx.html">SETNX key value</a> åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶è®¾ç½® key çš„å€¼ã€‚</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-setrange.html">SETRANGE key offset value</a> ç”¨ value å‚æ•°è¦†å†™ç»™å®š key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œä»åç§»é‡ offset å¼€å§‹ã€‚ï¼ˆ<strong>ç´¢å¼•ä»0****å¼€å§‹</strong>)</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-getrange.html"><strong>GETRANGE</strong> key start end</a> è¿”å› key ä¸­å­—ç¬¦ä¸²å€¼çš„å­å­—ç¬¦ï¼Œ<strong>å·¦é—­å³é—­</strong></td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><strong>MSETNX</strong> key value [key value â€¦] åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®š key éƒ½ä¸å­˜åœ¨ã€‚<strong>åŸå­æ€§ï¼Œæœ‰ä¸€ä¸ªå¤±è´¥åˆ™éƒ½å¤±è´¥</strong></td>
</tr>
<tr>
<td align="left">18</td>
<td align="left">APPEND key value å¦‚æœ key å·²ç»å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ APPEND å‘½ä»¤å°†æŒ‡å®šçš„ value è¿½åŠ åˆ°è¯¥ key åŸæ¥å€¼ï¼ˆvalueï¼‰çš„æœ«å°¾ã€‚</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-psetex.html">PSETEX key milliseconds value</a> è¿™ä¸ªå‘½ä»¤å’Œ SETEX å‘½ä»¤ç›¸ä¼¼ï¼Œä½†å®ƒä»¥æ¯«ç§’ä¸ºå•ä½è®¾ç½® key çš„ç”Ÿå­˜æ—¶é—´ï¼Œè€Œä¸æ˜¯åƒ SETEX å‘½ä»¤é‚£æ ·ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/strings-incrbyfloat.html">INCRBYFLOAT key increment</a> å°† key æ‰€å‚¨å­˜çš„å€¼åŠ ä¸Šç»™å®šçš„æµ®ç‚¹å¢é‡å€¼ï¼ˆincrementï¼‰ ã€‚</td>
</tr>
</tbody></table>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<p><strong>ç¼“å­˜å¯¹è±¡</strong></p>
<p>ä½¿ç”¨ String æ¥ç¼“å­˜å¯¹è±¡æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>ç›´æ¥ç¼“å­˜æ•´ä¸ªå¯¹è±¡çš„ JSONï¼Œå‘½ä»¤ä¾‹å­ï¼š <code>SET user:1 &#39;&#123;&quot;name&quot;:&quot;xiaolin&quot;, &quot;age&quot;:18&#125;&#39;</code>ã€‚</li>
<li>é‡‡ç”¨å°† key è¿›è¡Œåˆ†ç¦»ä¸º user:ID:å±æ€§ï¼Œé‡‡ç”¨ MSET å­˜å‚¨ï¼Œç”¨ MGET è·å–å„å±æ€§å€¼ï¼Œå‘½ä»¤ä¾‹å­ï¼š <code>MSET user:1:name xiaolin user:1:age 18 user:2:name xiaomei user:2:age 20</code>ã€‚</li>
</ul>
<p><strong>å¸¸è§„è®¡æ•°</strong></p>
<p><strong>åˆ†å¸ƒå¼é”</strong></p>
<p>SET å‘½ä»¤æœ‰ä¸ª NX å‚æ•°å¯ä»¥å®ç°ã€Œkeyä¸å­˜åœ¨æ‰æ’å…¥ã€ï¼Œå¯ä»¥ç”¨å®ƒæ¥å®ç°åˆ†å¸ƒå¼é”ï¼š</p>
<ul>
<li>å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™æ˜¾ç¤ºæ’å…¥æˆåŠŸï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŠ é”æˆåŠŸï¼›</li>
<li>å¦‚æœ key å­˜åœ¨ï¼Œåˆ™ä¼šæ˜¾ç¤ºæ’å…¥å¤±è´¥ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŠ é”å¤±è´¥ã€‚</li>
</ul>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œè¿˜ä¼šå¯¹åˆ†å¸ƒå¼é”åŠ ä¸Šè¿‡æœŸæ—¶é—´ï¼Œåˆ†å¸ƒå¼é”çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET lock_key unique_value NX PX 10000</span><br></pre></td></tr></table></figure>

<ul>
<li>lock_key å°±æ˜¯ key é”®ï¼›</li>
<li>unique_value æ˜¯å®¢æˆ·ç«¯ç”Ÿæˆçš„å”¯ä¸€çš„æ ‡è¯†ï¼›</li>
<li>NX ä»£è¡¨åªåœ¨ lock_key ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹ lock_key è¿›è¡Œè®¾ç½®æ“ä½œï¼›</li>
<li>PX 10000 è¡¨ç¤ºè®¾ç½® lock_key çš„è¿‡æœŸæ—¶é—´ä¸º 10sï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸è€Œæ— æ³•é‡Šæ”¾é”ã€‚</li>
</ul>
<p>è€Œè§£é”çš„è¿‡ç¨‹å°±æ˜¯å°† lock_key é”®åˆ é™¤ï¼Œä½†ä¸èƒ½ä¹±åˆ ï¼Œè¦ä¿è¯æ‰§è¡Œæ“ä½œçš„å®¢æˆ·ç«¯å°±æ˜¯åŠ é”çš„å®¢æˆ·ç«¯ã€‚æ‰€ä»¥ï¼Œè§£é”çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å…ˆåˆ¤æ–­é”çš„ unique_value æ˜¯å¦ä¸ºåŠ é”å®¢æˆ·ç«¯ï¼Œæ˜¯çš„è¯ï¼Œæ‰å°† lock_key é”®åˆ é™¤ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè§£é”æ˜¯æœ‰ä¸¤ä¸ªæ“ä½œï¼Œè¿™æ—¶å°±éœ€è¦ Lua è„šæœ¬æ¥ä¿è¯è§£é”çš„åŸå­æ€§ï¼Œå› ä¸º Redis åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ï¼Œå¯ä»¥ä»¥åŸå­æ€§çš„æ–¹å¼æ‰§è¡Œï¼Œä¿è¯äº†é”é‡Šæ”¾æ“ä½œçš„åŸå­æ€§ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// é‡Šæ”¾é”æ—¶ï¼Œå…ˆæ¯”è¾ƒ unique_value æ˜¯å¦ç›¸ç­‰ï¼Œé¿å…é”çš„è¯¯é‡Šæ”¾</span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¸€æ¥ï¼Œå°±é€šè¿‡ä½¿ç”¨ SET å‘½ä»¤å’Œ Lua è„šæœ¬åœ¨ Redis å•èŠ‚ç‚¹ä¸Šå®Œæˆäº†åˆ†å¸ƒå¼é”çš„åŠ é”å’Œè§£é”ã€‚</p>
<h4 id="2-2Hash"><a href="#2-2Hash" class="headerlink" title="2.2Hash"></a>2.2Hash</h4><p>Redis hash æ˜¯ä¸€ä¸ªé”®å€¼(key&#x3D;&gt;value)å¯¹é›†åˆã€‚</p>
<p>Redis hash æ˜¯ä¸€ä¸ª string ç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œhash ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</p>
<p><strong>å¸¸ç”¨å‘½ä»¤</strong></p>
<table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">å‘½ä»¤åŠæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hset.html"><strong>HSET key field value</strong></a> å°†å“ˆå¸Œè¡¨ key ä¸­çš„å­—æ®µ field çš„å€¼è®¾ä¸º value ã€‚</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hget.html">HGET key field</a> è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼ã€‚</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hmset.html"><strong>HMSET key field1 value1 field2 value2</strong> </a> åŒæ—¶å°†å¤šä¸ª field-value (åŸŸ-å€¼)å¯¹è®¾ç½®åˆ°å“ˆå¸Œè¡¨ key ä¸­ã€‚</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hmget.html"><strong>HMGET key field1 field2</strong></a> è·å–æ‰€æœ‰ç»™å®šå­—æ®µçš„å€¼</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hexists.html"><strong>HEXISTS key field</strong></a> æŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼ŒæŒ‡å®šçš„å­—æ®µæ˜¯å¦å­˜åœ¨ã€‚</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hkeys.html"><strong>HKEYS key</strong></a> è·å–æ‰€æœ‰å“ˆå¸Œè¡¨ä¸­çš„å­—æ®µ</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hvals.html"><strong>HVALS key</strong></a> è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å€¼ã€‚</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hincrby.html"><strong>HINCRBY key field increment</strong></a> ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„æŒ‡å®šå­—æ®µçš„æ•´æ•°å€¼åŠ ä¸Šå¢é‡ increment ã€‚</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hsetnx.html"><strong>HSETNX key field value</strong></a> åªæœ‰åœ¨å­—æ®µ field <code>ä¸å­˜åœ¨æ—¶</code>ï¼Œè®¾ç½®å“ˆå¸Œè¡¨å­—æ®µçš„å€¼ã€‚</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hdel.html">HDEL key field1 field2</a> åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå“ˆå¸Œè¡¨å­—æ®µ</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hgetall.html">HGETALL key</a> è·å–åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®š key çš„æ‰€æœ‰å­—æ®µå’Œå€¼</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hincrbyfloat.html">HINCRBYFLOAT key field increment</a> ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„æŒ‡å®šå­—æ®µçš„æµ®ç‚¹æ•°å€¼åŠ ä¸Šå¢é‡ increment ã€‚</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hlen.html">HLEN key</a> è·å–å“ˆå¸Œè¡¨ä¸­å­—æ®µçš„æ•°é‡</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left">[HSCAN key cursor <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/hashes-hscan.html">MATCH pattern] [COUNT count]</a> è¿­ä»£å“ˆå¸Œè¡¨ä¸­çš„é”®å€¼å¯¹ã€‚</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HMSET user:1 username ajeet password javatpoint alexa 2000  </span><br><span class="line">OK  </span><br><span class="line">HGETALL  user:1  </span><br><span class="line">&quot;username&quot;  </span><br><span class="line">&quot;ajeet&quot;  </span><br><span class="line">&quot;password&quot;  </span><br><span class="line">&quot;javatpoint&quot;  </span><br><span class="line">&quot;alexa&quot;  </span><br><span class="line">&quot;2000&quot; </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼ŒHMSET å’Œ HGETALL æ˜¯ Redis çš„å‘½ä»¤ï¼Œè€Œ user:1 æ˜¯é”®ã€‚</p>
<p>æ¯ä¸ªå“ˆå¸Œå¯ä»¥å­˜å‚¨å¤šè¾¾ 2^32^-1ä¸ªå­—æ®µ-å€¼å¯¹ï¼ˆ40å¤šäº¿ï¼‰ã€‚</p>
<p>æ•°æ®ç»“æ„</p>
<p>Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>å‹ç¼©åˆ—è¡¨æˆ–å“ˆå¸Œè¡¨</strong>å®ç°çš„ï¼š</p>
<ul>
<li>å¦‚æœå“ˆå¸Œç±»å‹å…ƒç´ ä¸ªæ•°å°äº <code>512</code> ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>hash-max-ziplist-entries</code> é…ç½®ï¼‰ï¼Œæ‰€æœ‰å€¼å°äº <code>64</code> å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>hash-max-ziplist-value</code> é…ç½®ï¼‰çš„è¯ï¼ŒRedis ä¼šä½¿ç”¨<strong>å‹ç¼©åˆ—è¡¨</strong>ä½œä¸º Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li>
<li>å¦‚æœå“ˆå¸Œç±»å‹å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>å“ˆå¸Œè¡¨</strong>ä½œä¸º Hash ç±»å‹çš„ åº•å±‚æ•°æ®ç»“æ„ã€‚</li>
</ul>
<p><strong>åœ¨ Redis 7.0 ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack æ•°æ®ç»“æ„æ¥å®ç°äº†</strong>ã€‚</p>
<h4 id="2-3åˆ—è¡¨list"><a href="#2-3åˆ—è¡¨list" class="headerlink" title="2.3åˆ—è¡¨list"></a>2.3åˆ—è¡¨list</h4><p>Redis åˆ—è¡¨å®šä¹‰ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰<strong>æ’å…¥é¡ºåºæ’åº</strong>ã€‚å¯ä»¥å°†å…ƒç´ æ·»åŠ åˆ° Redis åˆ—è¡¨çš„å¤´éƒ¨æˆ–å°¾éƒ¨ã€‚</p>
<p>åˆ—è¡¨çš„æœ€å¤§é•¿åº¦ä¸º <code>2^32 - 1</code>ï¼Œä¹Ÿå³æ¯ä¸ªåˆ—è¡¨æ”¯æŒè¶…è¿‡ <code>40 äº¿</code>ä¸ªå…ƒç´ ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; lpush k1 redis</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; lpush k1 mongodb</span><br><span class="line">(integer) 2</span><br><span class="line">redis 127.0.0.1:6379&gt; lpush k1 rabbitmq</span><br><span class="line">(integer) 3</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange k1 0 10</span><br><span class="line">1) &quot;rabbitmq&quot;</span><br><span class="line">2) &quot;mongodb&quot;</span><br><span class="line">3) &quot;redis&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>

<p><strong>å¸¸ç”¨å‘½ä»¤</strong></p>
<table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">å‘½ä»¤åŠæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lpush.html"><strong>LPUSH key value1 value2</strong></a> å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-rpush.html"><strong>RPUSH key value1 value2</strong></a> åœ¨åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå€¼</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lpop.html"><strong>LPOP key</strong></a> ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-rpop.html"><strong>RPOP key</strong></a> ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›å€¼ä¸ºç§»é™¤çš„å…ƒç´ ã€‚</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-blpop.html"><strong>BLPOP key1 [key2]  timeout</strong></a> ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢ã€‚</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-brpop.html"><strong>BRPOP key1 [key2]  timeout</strong></a> ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢ã€‚</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-brpoplpush.html">BRPOPLPUSH source destination timeout</a> ä»åˆ—è¡¨ä¸­å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå°†å¼¹å‡ºçš„å…ƒç´ æ’å…¥åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨ä¸­å¹¶è¿”å›å®ƒï¼› å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢ã€‚</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lindex.html"><strong>LINDEX key index</strong></a> é€šè¿‡ç´¢å¼•è·å–åˆ—è¡¨ä¸­çš„å…ƒç´ </td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>LRANGE key start stop</strong>è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´  ,<strong>-1</strong>å¯ä»¥ä»£è¡¨æœ€åä¸€ä¸ª</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-llen.html"><strong>LLEN key</strong></a> è·å–åˆ—è¡¨é•¿åº¦</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-linsert.html"><strong>LINSERT key BEFORE|AFTER pivot value</strong></a> åœ¨åˆ—è¡¨çš„å…ƒç´ å‰æˆ–è€…åæ’å…¥å…ƒç´ </td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lset.html"><strong>LSET key index value</strong></a> é€šè¿‡ç´¢å¼•è®¾ç½®åˆ—è¡¨å…ƒç´ çš„å€¼</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lrem.html"><strong>LREM key count value</strong></a> ç§»é™¤åˆ—è¡¨å…ƒç´ ï¼Œcount &gt; 0 : ä»è¡¨å¤´å¼€å§‹å‘è¡¨å°¾æœç´¢ï¼Œç§»é™¤ä¸ VALUE ç›¸ç­‰çš„å…ƒç´ ï¼Œæ•°é‡ä¸º COUNT ã€‚count &lt; 0 : ä»è¡¨å°¾å¼€å§‹å‘è¡¨å¤´æœç´¢ï¼›count &#x3D; 0 : ç§»é™¤è¡¨ä¸­æ‰€æœ‰ä¸ VALUE ç›¸ç­‰çš„å€¼ã€‚</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-lpushx.html">LPUSHX key value</a> å°†ä¸€ä¸ªå€¼æ’å…¥åˆ°å·²å­˜åœ¨çš„åˆ—è¡¨å¤´éƒ¨</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-rpushx.html">RPUSHX key value</a> ä¸ºå·²å­˜åœ¨çš„åˆ—è¡¨æ·»åŠ å€¼</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-ltrim.html">LTRIM key start stop</a> å¯¹ä¸€ä¸ªåˆ—è¡¨è¿›è¡Œä¿®å‰ª(trim)ï¼Œå°±æ˜¯è¯´ï¼Œè®©åˆ—è¡¨åªä¿ç•™æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ï¼Œä¸åœ¨æŒ‡å®šåŒºé—´ä¹‹å†…çš„å…ƒç´ éƒ½å°†è¢«åˆ é™¤ã€‚</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/lists-rpoplpush.html">RPOPLPUSH source destination</a> ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨å¹¶è¿”å›</td>
</tr>
</tbody></table>
<p><strong>æ•°æ®ç»“æ„</strong></p>
<p>List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>åŒå‘é“¾è¡¨æˆ–å‹ç¼©åˆ—è¡¨</strong>å®ç°çš„ï¼š</p>
<ul>
<li>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å°äº <code>512</code> ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>list-max-ziplist-entries</code> é…ç½®ï¼‰ï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äº <code>64</code> å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>list-max-ziplist-value</code> é…ç½®ï¼‰ï¼ŒRedis ä¼šä½¿ç”¨<strong>å‹ç¼©åˆ—è¡¨</strong>ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li>
<li>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>åŒå‘é“¾è¡¨</strong>ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li>
</ul>
<p>ä½†æ˜¯<strong>åœ¨ Redis 3.2 ç‰ˆæœ¬ä¹‹åï¼ŒList æ•°æ®ç±»å‹åº•å±‚æ•°æ®ç»“æ„å°±åªç”± quicklist å®ç°äº†ï¼Œæ›¿ä»£äº†åŒå‘é“¾è¡¨å’Œå‹ç¼©åˆ—è¡¨</strong>ã€‚</p>
<p>å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ã€‚æ¯”å¦‚è¿™ä¸ªåˆ—è¡¨é‡Œå­˜çš„åªæ˜¯intç±»å‹çš„æ•°æ®ï¼Œç»“æ„ä¸Šè¿˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆprevå’Œnextã€‚Rediså°†é“¾è¡¨å’Œziplistç»“åˆèµ·æ¥ç»„æˆäº†quicklistã€‚ä¹Ÿå°±æ˜¯å°†å¤šä¸ªziplistä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™ã€‚</p>
<p>åº”ç”¨åœºæ™¯</p>
<p><a target="_blank" rel="noopener" href="https://xiaolincoding.com/redis/data_struct/command.html#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97">æ¶ˆæ¯é˜Ÿåˆ—</a></p>
<h4 id="2-4é›†åˆset"><a href="#2-4é›†åˆset" class="headerlink" title="2.4é›†åˆset"></a>2.4é›†åˆset</h4><p>Redis çš„ Set æ˜¯ String ç±»å‹çš„æ— åºé›†åˆã€‚é›†åˆæˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œè¿™å°±æ„å‘³ç€é›†åˆä¸­ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ã€‚</p>
<p>é›†åˆå¯¹è±¡çš„ç¼–ç å¯ä»¥æ˜¯ intset æˆ–è€… hashtableã€‚</p>
<p>Redis ä¸­é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å®ç°çš„ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚</p>
<p>é›†åˆä¸­æœ€å¤§çš„æˆå‘˜æ•°ä¸º 232 - 1 (4294967295, æ¯ä¸ªé›†åˆå¯å­˜å‚¨40å¤šäº¿ä¸ªæˆå‘˜)ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; SADD w3ckey redis</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; SADD w3ckey mongodb</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; SADD w3ckey mysql</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; SADD w3ckey mysql</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; SMEMBERS w3ckey</span><br><span class="line"> </span><br><span class="line">1) &quot;mysql&quot;</span><br><span class="line">2) &quot;mongodb&quot;</span><br><span class="line">3) &quot;redis&quot;</span><br></pre></td></tr></table></figure>

<p><strong>å¸¸ç”¨å‘½ä»¤</strong></p>
<p>ä¸‹è¡¨åˆ—å‡ºäº† Redis é›†åˆåŸºæœ¬å‘½ä»¤ï¼š</p>
<table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">å‘½ä»¤åŠæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>SADD key member1 [member2]</strong> å‘é›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3603.html"><strong>SPOP key</strong> [count] </a> ç§»é™¤å¹¶è¿”å›é›†åˆä¸­çš„ä¸€ä¸ªéšæœºå…ƒç´ ï¼Œå¯ä»¥å®ç°æŠ½å¥–åŠŸèƒ½ï¼ŒåŠ countå°±æ˜¯ç§»é™¤countä¸ª</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3595.html"><strong>SCARD key</strong></a> è·å–é›†åˆçš„æˆå‘˜æ•°</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>SREM key member1 [member2]</strong> ç§»é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3601.html"><strong>SMEMBERS key</strong></a> è¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3600.html"><strong>SISMEMBER key member</strong></a> åˆ¤æ–­ member å…ƒç´ æ˜¯å¦æ˜¯é›†åˆ key çš„æˆå‘˜</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>SRANDMEMBER key [count]</strong> è¿”å›é›†åˆä¸­éšæœºé€‰å‡ºcountä¸ªå…ƒç´ ï¼Œ<code>å…ƒç´ ä¸ä¼šä»keyä¸­åˆ é™¤</code></td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">SDIFF key1 [key2] è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„å·®é›†</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">SDIFFSTORE destination key1 [key2] è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„å·®é›†å¹¶å­˜å‚¨åœ¨ destination ä¸­</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">SINTER key1 [key2] è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„äº¤é›†</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">SINTERSTORE destination key1 [key2] è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„äº¤é›†å¹¶å­˜å‚¨åœ¨ destination ä¸­</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3602.html">SMOVE source destination member</a> å°† member å…ƒç´ ä» source é›†åˆç§»åŠ¨åˆ° destination é›†åˆ</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left">SUNION key1 [key2] è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left">SUNIONSTORE destination key1 [key2] æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†å­˜å‚¨åœ¨ destination é›†åˆä¸­</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left">[SSCAN key cursor <a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3608.html">MATCH pattern] [COUNT count]</a> è¿­ä»£é›†åˆä¸­çš„å…ƒç´ </td>
</tr>
</tbody></table>
<p>å†…éƒ¨å®ç°</p>
<p>Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>å“ˆå¸Œè¡¨æˆ–æ•´æ•°é›†åˆ</strong>å®ç°çš„ï¼š</p>
<ul>
<li>å¦‚æœé›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°ä¸”å…ƒç´ ä¸ªæ•°å°äº <code>512</code> ï¼ˆé»˜è®¤å€¼ï¼Œ<code>set-maxintset-entries</code>é…ç½®ï¼‰ä¸ªï¼ŒRedis ä¼šä½¿ç”¨<strong>æ•´æ•°é›†åˆ</strong>ä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li>
<li>å¦‚æœé›†åˆä¸­çš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢æ¡ä»¶ï¼Œåˆ™ Redis ä½¿ç”¨<strong>å“ˆå¸Œè¡¨</strong>ä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ã€‚</li>
</ul>
<p><strong>åº”ç”¨åœºæ™¯</strong></p>
<p><strong>ç‚¹èµ</strong></p>
<p>Set ç±»å‹å¯ä»¥ä¿è¯ä¸€ä¸ªç”¨æˆ·åªèƒ½ç‚¹ä¸€ä¸ªèµï¼Œè¿™é‡Œä¸¾ä¾‹å­ä¸€ä¸ªåœºæ™¯ï¼Œkey æ˜¯æ–‡ç« idï¼Œvalue æ˜¯ç”¨æˆ·idã€‚</p>
<p><code>uid:1</code> ã€<code>uid:2</code>ã€<code>uid:3</code> ä¸‰ä¸ªç”¨æˆ·åˆ†åˆ«å¯¹ article:1 æ–‡ç« ç‚¹èµäº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">uid:1 ç”¨æˆ·å¯¹æ–‡ç«  article:1 ç‚¹èµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SADD article:1 uid:1</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">uid:2 ç”¨æˆ·å¯¹æ–‡ç«  article:1 ç‚¹èµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SADD article:1 uid:2</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">uid:3 ç”¨æˆ·å¯¹æ–‡ç«  article:1 ç‚¹èµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SADD article:1 uid:3</span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<p><code>uid:1</code> å–æ¶ˆäº†å¯¹ article:1 æ–‡ç« ç‚¹èµã€‚</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; SREM article:1 uid:1</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<p>è·å– article:1 æ–‡ç« æ‰€æœ‰ç‚¹èµç”¨æˆ· :</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SMEMBERS article:1</span></span><br><span class="line">1) &quot;uid:3&quot;</span><br><span class="line">2) &quot;uid:2&quot;</span><br></pre></td></tr></table></figure>

<p>è·å– article:1 æ–‡ç« çš„ç‚¹èµç”¨æˆ·æ•°é‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SCARD article:1</span></span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­ç”¨æˆ· <code>uid:1</code> æ˜¯å¦å¯¹æ–‡ç«  article:1 ç‚¹èµäº†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SISMEMBER article:1 uid:1</span></span><br><span class="line">(integer) 0  # è¿”å›0è¯´æ˜æ²¡ç‚¹èµï¼Œè¿”å›1åˆ™è¯´æ˜ç‚¹èµäº†</span><br></pre></td></tr></table></figure>

<p><strong>å…±åŒå…³æ³¨</strong></p>
<p>Set ç±»å‹æ”¯æŒäº¤é›†è¿ç®—ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥è®¡ç®—å…±åŒå…³æ³¨çš„å¥½å‹ã€å…¬ä¼—å·ç­‰ã€‚</p>
<p>key å¯ä»¥æ˜¯ç”¨æˆ·idï¼Œvalue åˆ™æ˜¯å·²å…³æ³¨çš„å…¬ä¼—å·çš„idã€‚</p>
<p><code>uid:1</code> ç”¨æˆ·å…³æ³¨å…¬ä¼—å· id ä¸º 5ã€6ã€7ã€8ã€9ï¼Œ<code>uid:2</code> ç”¨æˆ·å…³æ³¨å…¬ä¼—å· id ä¸º 7ã€8ã€9ã€10ã€11ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">uid:1 ç”¨æˆ·å…³æ³¨å…¬ä¼—å· <span class="built_in">id</span> ä¸º 5ã€6ã€7ã€8ã€9</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SADD uid:1 5 6 7 8 9</span></span><br><span class="line">(integer) 5</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">uid:2  ç”¨æˆ·å…³æ³¨å…¬ä¼—å· <span class="built_in">id</span> ä¸º 7ã€8ã€9ã€10ã€11</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SADD uid:2 7 8 9 10 11</span></span><br><span class="line">(integer) 5</span><br></pre></td></tr></table></figure>

<p><code>uid:1</code> å’Œ <code>uid:2</code> å…±åŒå…³æ³¨çš„å…¬ä¼—å·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å…±åŒå…³æ³¨</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SINTER uid:1 uid:2</span></span><br><span class="line">1) &quot;7&quot;</span><br><span class="line">2) &quot;8&quot;</span><br><span class="line">3) &quot;9&quot;</span><br></pre></td></tr></table></figure>

<p>ç»™ <code>uid:2</code> æ¨è <code>uid:1</code> å…³æ³¨çš„å…¬ä¼—å·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SDIFF uid:1 uid:2</span></span><br><span class="line">1) &quot;5&quot;</span><br><span class="line">2) &quot;6&quot;</span><br></pre></td></tr></table></figure>

<p>éªŒè¯æŸä¸ªå…¬ä¼—å·æ˜¯å¦åŒæ—¶è¢« <code>uid:1</code> æˆ– <code>uid:2</code> å…³æ³¨:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SISMEMBER uid:1 5</span></span><br><span class="line">(integer) 1 # è¿”å›0ï¼Œè¯´æ˜å…³æ³¨äº†</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SISMEMBER uid:2 5</span></span><br><span class="line">(integer) 0 # è¿”å›0ï¼Œè¯´æ˜æ²¡å…³æ³¨</span><br></pre></td></tr></table></figure>

<p><strong>æŠ½å¥–æ´»åŠ¨</strong></p>
<p>å­˜å‚¨æŸæ´»åŠ¨ä¸­ä¸­å¥–çš„ç”¨æˆ·å ï¼ŒSet ç±»å‹å› ä¸ºæœ‰å»é‡åŠŸèƒ½ï¼Œå¯ä»¥ä¿è¯åŒä¸€ä¸ªç”¨æˆ·ä¸ä¼šä¸­å¥–ä¸¤æ¬¡ã€‚</p>
<p>keyä¸ºæŠ½å¥–æ´»åŠ¨åï¼Œvalueä¸ºå‘˜å·¥åç§°ï¼ŒæŠŠæ‰€æœ‰å‘˜å·¥åç§°æ”¾å…¥æŠ½å¥–ç®± ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">SADD lucky Tom Jerry John Sean Marry Lindy Sary Mark</span></span><br><span class="line">(integer) 5</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå…è®¸é‡å¤ä¸­å¥–ï¼Œå¯ä»¥ä½¿ç”¨ SRANDMEMBER å‘½ä»¤ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ½å– 1 ä¸ªä¸€ç­‰å¥–ï¼š</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SRANDMEMBER lucky 1</span></span><br><span class="line">1) &quot;Tom&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ½å– 2 ä¸ªäºŒç­‰å¥–ï¼š</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SRANDMEMBER lucky 2</span></span><br><span class="line">1) &quot;Mark&quot;</span><br><span class="line">2) &quot;Jerry&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ½å– 3 ä¸ªä¸‰ç­‰å¥–ï¼š</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SRANDMEMBER lucky 3</span></span><br><span class="line">1) &quot;Sary&quot;</span><br><span class="line">2) &quot;Tom&quot;</span><br><span class="line">3) &quot;Jerry&quot;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸å…è®¸é‡å¤ä¸­å¥–ï¼Œå¯ä»¥ä½¿ç”¨ SPOP å‘½ä»¤ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ½å–ä¸€ç­‰å¥–1ä¸ª</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SPOP lucky 1</span></span><br><span class="line">1) &quot;Sary&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ½å–äºŒç­‰å¥–2ä¸ª</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SPOP lucky 2</span></span><br><span class="line">1) &quot;Jerry&quot;</span><br><span class="line">2) &quot;Mark&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ½å–ä¸‰ç­‰å¥–3ä¸ª</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">SPOP lucky 3</span></span><br><span class="line">1) &quot;John&quot;</span><br><span class="line">2) &quot;Sean&quot;</span><br><span class="line">3) &quot;Lindy&quot;</span><br></pre></td></tr></table></figure>





<h4 id="2-5æœ‰åºé›†åˆsorted-set"><a href="#2-5æœ‰åºé›†åˆsorted-set" class="headerlink" title="2.5æœ‰åºé›†åˆsorted set"></a>2.5æœ‰åºé›†åˆsorted set</h4><p>Redis æœ‰åºé›†åˆå’Œé›†åˆä¸€æ ·ä¹Ÿæ˜¯ string ç±»å‹å…ƒç´ çš„é›†åˆ,ä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚</p>
<p>ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ª double ç±»å‹çš„åˆ†æ•°ã€‚redis æ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚</p>
<p>æœ‰åºé›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„,ä½†åˆ†æ•°(score)å´å¯ä»¥é‡å¤ã€‚</p>
<p>é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å®ç°çš„ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚ é›†åˆä¸­æœ€å¤§çš„æˆå‘˜æ•°ä¸º 2^32^ - 1 (4294967295, æ¯ä¸ªé›†åˆå¯å­˜å‚¨40å¤šäº¿ä¸ªæˆå‘˜)ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; ZADD runoobkey 1 redis</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; ZADD runoobkey 2 mongodb</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; ZADD runoobkey 3 mysql</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; ZADD runoobkey 3 mysql</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; ZADD runoobkey 4 mysql</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; ZRANGE runoobkey 0 10 WITHSCORES</span><br><span class="line"></span><br><span class="line">1) &quot;redis&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;mongodb&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">5) &quot;mysql&quot;</span><br><span class="line">6) &quot;4&quot;</span><br></pre></td></tr></table></figure>

<p><strong>å¸¸ç”¨å‘½ä»¤</strong></p>
<p>ä¸‹è¡¨åˆ—å‡ºäº† redis æœ‰åºé›†åˆçš„åŸºæœ¬å‘½ä»¤:</p>
<table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">å‘½ä»¤åŠæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>ZADD key score1 member1 [score2 member2]</strong> å‘æœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œæˆ–è€…æ›´æ–°å·²å­˜åœ¨æˆå‘˜çš„åˆ†æ•°</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3610.html"><strong>ZCARD key</strong></a> è·å–æœ‰åºé›†åˆçš„æˆå‘˜æ•°</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>ZREM key member [member â€¦]</strong> ç§»é™¤æœ‰åºé›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3626.html"><strong>ZSCORE key member</strong></a> è¿”å›æœ‰åºé›†ä¸­ï¼Œæˆå‘˜çš„åˆ†æ•°å€¼</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3612.html"><strong>ZINCRBY key increment member</strong></a> æœ‰åºé›†åˆä¸­å¯¹æŒ‡å®šæˆå‘˜çš„åˆ†æ•°åŠ ä¸Šå¢é‡ increment</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>ZRANGE key start stop [WITHSCORES]</strong> é€šè¿‡ç´¢å¼•åŒºé—´è¿”å›æœ‰åºé›†åˆæˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>ZRANGEBYLEX key min max [LIMIT offset count]</strong> é€šè¿‡å­—å…¸åŒºé—´è¿”å›æœ‰åºé›†åˆçš„æˆå‘˜</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3617.html"><strong>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count</strong>]</a> é€šè¿‡åˆ†æ•°è¿”å›æœ‰åºé›†åˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3620.html">ZREMRANGEBYLEX key min max</a> ç§»é™¤æœ‰åºé›†åˆä¸­ç»™å®šçš„å­—å…¸åŒºé—´çš„æ‰€æœ‰æˆå‘˜</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3622.html">ZREMRANGEBYSCORE key min max</a> ç§»é™¤æœ‰åºé›†åˆä¸­ç»™å®šçš„åˆ†æ•°åŒºé—´çš„æ‰€æœ‰æˆå‘˜</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3621.html">ZREMRANGEBYRANK key start stop</a> ç§»é™¤æœ‰åºé›†åˆä¸­ç»™å®šçš„æ’ååŒºé—´çš„æ‰€æœ‰æˆå‘˜</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3611.html">ZCOUNT key min max</a> è®¡ç®—åœ¨æœ‰åºé›†åˆä¸­æŒ‡å®šåŒºé—´åˆ†æ•°çš„æˆå‘˜æ•°</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">ZINTERSTORE destination numkeys key [key â€¦] è®¡ç®—ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰åºé›†çš„äº¤é›†å¹¶å°†ç»“æœé›†å­˜å‚¨åœ¨æ–°çš„æœ‰åºé›†åˆ key ä¸­</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left">ZUNIONSTORE destination numkeys key [key â€¦]è®¡ç®—ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰åºé›†çš„å¹¶é›†ï¼Œå¹¶å­˜å‚¨åœ¨æ–°çš„ key ä¸­</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3614.html">ZLEXCOUNT key min max</a> åœ¨æœ‰åºé›†åˆä¸­è®¡ç®—æŒ‡å®šå­—å…¸åŒºé—´å†…æˆå‘˜æ•°é‡</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3618.html">ZRANK key member</a> è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šæˆå‘˜çš„ç´¢å¼•</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left">ZREVRANGE key start stop [WITHSCORES] è¿”å›æœ‰åºé›†ä¸­æŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ï¼Œé€šè¿‡ç´¢å¼•ï¼Œåˆ†æ•°ä»é«˜åˆ°åº•</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left">ZREVRANGEBYSCORE key max min [WITHSCORES] è¿”å›æœ‰åºé›†ä¸­æŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„æˆå‘˜ï¼Œåˆ†æ•°ä»é«˜åˆ°ä½æ’åº</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3625.html">ZREVRANK key member</a> è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šæˆå‘˜çš„æ’åï¼Œæœ‰åºé›†æˆå‘˜æŒ‰åˆ†æ•°å€¼é€’å‡(ä»å¤§åˆ°å°)æ’åº</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left">[ZSCAN key cursor <a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3628.html">MATCH pattern] [COUNT count]</a> è¿­ä»£æœ‰åºé›†åˆä¸­çš„å…ƒç´ ï¼ˆåŒ…æ‹¬å…ƒç´ æˆå‘˜å’Œå…ƒç´ åˆ†å€¼ï¼‰</td>
</tr>
</tbody></table>
<p>å†…éƒ¨å®ç°</p>
<p>Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>å‹ç¼©åˆ—è¡¨æˆ–è·³è¡¨</strong>å®ç°çš„ï¼š</p>
<ul>
<li>å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸ªæ•°å°äº <code>128</code> ä¸ªï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äº <code>64</code> å­—èŠ‚æ—¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>å‹ç¼©åˆ—è¡¨</strong>ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li>
<li>å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>è·³è¡¨</strong>ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li>
</ul>
<p><strong>åœ¨ Redis 7.0 ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack æ•°æ®ç»“æ„æ¥å®ç°äº†ã€‚</strong></p>
<p><strong>åº”ç”¨åœºæ™¯</strong></p>
<p><strong>æ’è¡Œæ¦œ</strong></p>
<p>æœ‰åºé›†åˆæ¯”è¾ƒå…¸å‹çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯æ’è¡Œæ¦œã€‚ä¾‹å¦‚å­¦ç”Ÿæˆç»©çš„æ’åæ¦œã€æ¸¸æˆç§¯åˆ†æ’è¡Œæ¦œã€è§†é¢‘æ’­æ”¾æ’åã€ç”µå•†ç³»ç»Ÿä¸­å•†å“çš„é”€é‡æ’åç­‰ã€‚</p>
<p><strong>ç”µè¯ã€å§“åæ’åº</strong></p>
<p>ä½¿ç”¨æœ‰åºé›†åˆçš„ <code>ZRANGEBYLEX</code> æˆ– <code>ZREVRANGEBYLEX</code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°ç”µè¯å·ç æˆ–å§“åçš„æ’åºï¼Œæˆ‘ä»¬ä»¥ <code>ZRANGEBYLEX</code> ï¼ˆè¿”å›æŒ‡å®šæˆå‘˜åŒºé—´å†…çš„æˆå‘˜ï¼ŒæŒ‰ key æ­£åºæ’åˆ—ï¼Œåˆ†æ•°å¿…é¡»ç›¸åŒï¼‰ä¸ºä¾‹ã€‚</p>
<p><strong>æ³¨æ„ï¼šä¸è¦åœ¨åˆ†æ•°ä¸ä¸€è‡´çš„ SortSet é›†åˆä¸­å»ä½¿ç”¨ ZRANGEBYLEXå’Œ ZREVRANGEBYLEX æŒ‡ä»¤ï¼Œå› ä¸ºè·å–çš„ç»“æœä¼šä¸å‡†ç¡®ã€‚</strong></p>
<h4 id="2-6-æ–°æ•°æ®ç±»å‹"><a href="#2-6-æ–°æ•°æ®ç±»å‹" class="headerlink" title="2.6 æ–°æ•°æ®ç±»å‹"></a>2.6 æ–°æ•°æ®ç±»å‹</h4><h6 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a><strong>Bitmaps</strong></h6><p>Redisæä¾›äº†Bitmapsè¿™ä¸ªâ€œæ•°æ®ç±»å‹â€å¯ä»¥å®ç°å¯¹ä½çš„æ“ä½œï¼š</p>
<p>ï¼ˆ1ï¼‰  Bitmapsæœ¬èº«ä¸æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œ å®é™…ä¸Šå®ƒå°±æ˜¯å­—ç¬¦ä¸²ï¼ˆkey-valueï¼‰ ï¼Œ ä½†æ˜¯å®ƒå¯ä»¥å¯¹å­—ç¬¦ä¸²çš„ä½è¿›è¡Œæ“ä½œã€‚</p>
<p>ï¼ˆ2ï¼‰  Bitmapså•ç‹¬æä¾›äº†ä¸€å¥—å‘½ä»¤ï¼Œ æ‰€ä»¥åœ¨Redisä¸­ä½¿ç”¨Bitmapså’Œä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•ä¸å¤ªç›¸åŒã€‚ å¯ä»¥æŠŠBitmapsæƒ³è±¡æˆä¸€ä¸ªä»¥ä½ä¸ºå•ä½çš„æ•°ç»„ï¼Œ æ•°ç»„çš„æ¯ä¸ªå•å…ƒåªèƒ½å­˜å‚¨0å’Œ1ï¼Œ æ•°ç»„çš„ä¸‹æ ‡åœ¨Bitmapsä¸­å«åšåç§»é‡ã€‚</p>
<p>å¸¸ç”¨å‘½ä»¤                       ä½œç”¨</p>
<p>1ã€<code>getbit key offset</code>   ç”¨äºè·å–æŒ‡å®škeyå¯¹åº”çš„å€¼ï¼Œä¸­å¯¹åº”offsetçš„bit ï¼Œå¯¹ä¸å­˜åœ¨çš„ key æˆ–è€…ä¸å­˜åœ¨çš„ offset è¿›è¡Œ GETBITï¼Œ è¿”å› 0</p>
<p>2ã€<code>setbit key offset value</code> ç”¨äºä¿®æ”¹æŒ‡å®škeyå¯¹åº”çš„å€¼ï¼Œä¸­å¯¹åº”offsetçš„bit</p>
<p>3ã€ <code>bitcount key [start end]</code>   ç”¨äºç»Ÿè®¡å­—ç¬¦ä¸²è¢«è®¾ç½®ä¸º1çš„bitæ•°</p>
<p>4ã€<code>bitop and/or/xor/not destkey key [key â€¦]</code> ç”¨äºä¸€ä¸ªæˆ–å¯¹å¤šä¸ªkeyæ±‚é€»è¾‘ä¸&#x2F;é€»è¾‘æˆ–&#x2F;é€»è¾‘å¼‚æˆ–&#x2F;é€»è¾‘éï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° destkey ä¸Š</p>
<p>BITOP AND destkey key [key â€¦] ï¼Œå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª key æ±‚é€»ä¸ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° destkey</p>
<p>BITOP OR destkey key [key â€¦] ï¼Œå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª key æ±‚é€»è¾‘æˆ–ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° destkey  å…¨0ä¸º0ï¼Œä¸å…¨0ä¸º1</p>
<p>BITOP XOR destkey key [key â€¦] ï¼Œå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª key æ±‚é€»è¾‘å¼‚æˆ–ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° destkey  ä¸åŒä¸º1ï¼Œç›¸åŒä¸º0</p>
<p>BITOP NOT destkey key ï¼Œå¯¹ç»™å®š key æ±‚é€»è¾‘éï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° destkey  æŒ‰ä½å–å</p>
<p>é™¤äº† NOT æ“ä½œä¹‹å¤–ï¼Œå…¶ä»–æ“ä½œéƒ½å¯ä»¥æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ª key ä½œä¸ºè¾“å…¥ï¼Œå½“ BITOP å¤„ç†ä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²æ—¶ï¼Œè¾ƒçŸ­çš„é‚£ä¸ªå­—ç¬¦ä¸²æ‰€ç¼ºå°‘çš„éƒ¨åˆ†ä¼šè¢«çœ‹ä½œ 0ï¼Œç©ºçš„ key ä¹Ÿè¢«çœ‹ä½œæ˜¯åŒ…å« 0 çš„å­—ç¬¦ä¸²åºåˆ—</p>
<p>BITOP AND destkey key [key â€¦]æ¼”ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; setbit k1 1 1</span><br><span class="line">(integer) 0</span><br><span class="line">&gt; setbit k2 7 1</span><br><span class="line">(integer) 0</span><br><span class="line">&gt; bitop and k3 k1 k2</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; get k3</span><br><span class="line">&quot;\x00&quot;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic4.zhimg.com/80/v2-29777bd1e55114d2b6277123165c45f7_720w.jpg" alt="img"></p>
<p>â€‹																									å…¨1ä¸º1ï¼Œä¸å…¨1ä¸º0</p>
<p><strong>æ¡ˆä¾‹</strong></p>
<p>Redis äº¿çº§ç”¨æˆ·ä¿¡æ¯å­˜å‚¨å®è·µï¼šbitmap ä½å›¾å­˜å‚¨</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ask.qcloudimg.com/http-save/yehe-2233022/811b1c3c2c73e86780e5c0560780beb4.png?imageView2/2/w/1620"></p>
<p>å¦‚æœä¸€ä¸ªç½‘ç«™æœ‰1äº¿ç”¨æˆ·,å‡å¦‚user_idç”¨çš„æ˜¯æ•´å‹,é•¿åº¦ä¸º32ä½,æ¯å¤©æœ‰5åƒä¸‡ç‹¬ç«‹ç”¨æˆ·è®¿é—®,å¦‚ä½•åˆ¤æ–­æ˜¯å“ª5åƒä¸‡ç”¨æˆ·è®¿é—®äº†ç½‘ç«™ã€‚</p>
<ul>
<li>æ–¹å¼ä¸€:ç”¨setæ¥ä¿å­˜</li>
</ul>
<p>ä½¿ç”¨setæ¥ä¿å­˜æ•°æ®è¿è¡Œä¸€å¤©éœ€è¦å ç”¨çš„å†…å­˜ä¸º 32bit*50000000&#x3D;(4 * 50000000) &#x2F; 1024 &#x2F;1024 MB,çº¦ä¸º200MB</p>
<p>è¿è¡Œä¸€ä¸ªæœˆéœ€è¦å ç”¨çš„å†…å­˜ä¸º30 * 200 &#x3D; 6Gï¼Œè¿è¡Œä¸€å¹´å ç”¨çš„å†…å­˜ä¸º72G</p>
<ul>
<li>æ–¹å¼äºŒï¼šä½¿ç”¨bitmapçš„æ–¹å¼</li>
</ul>
<p>user_idä½œä¸ºoffsetï¼Œå¦‚æœuser_idè®¿é—®ç½‘ç«™ï¼Œåˆ™åœ¨user_idçš„ç´¢å¼•ä¸Šè®¾ç½®ä¸º1ï¼Œæ²¡æœ‰è®¿é—®ç½‘ç«™çš„user_idï¼Œå…¶ç´¢å¼•è®¾ç½®ä¸º0ï¼Œæ­¤ç§æ–¹å¼è¿è¡Œä¸€å¤©å ç”¨çš„å†…å­˜ä¸º 1bit* 100000000 &#x3D; 100000000 &#x2F; 1024 &#x2F;1024&#x2F; 8MBï¼Œçº¦ä¸º12.5MB è¿è¡Œä¸€ä¸ªæœˆå ç”¨çš„å†…å­˜ä¸º375MBï¼Œä¸€å¹´å ç”¨çš„å†…å­˜å®¹é‡ä¸º4.5G</p>
<p>åœºæ™¯</p>
<p><strong>ç½‘ç«™ç”¨æˆ·ç­¾åˆ°çš„å¤©æ•°ç»Ÿè®¡</strong></p>
<p>ç”¨æˆ·IDä¸ºkeyï¼Œå¤©ä½œä¸ºoffsetï¼Œä¸Šçº¿ç½®ä¸º1 366&gt; 000000000000000</p>
<p>366 &#x2F;8&#x3D;46Byte IDä¸º18çš„ç”¨æˆ·ï¼Œä»Šå¹´çš„ç¬¬1å¤©ç­¾åˆ°ã€ç¬¬30å¤©ç­¾åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; setbit u18 1 1</span><br><span class="line">(integer) 0</span><br><span class="line">&gt; setbit u18 30 1</span><br><span class="line">(integer) 0</span><br><span class="line">&gt; bitcount u18 #ç»Ÿè®¡idä¸º18çš„ç”¨æˆ·ç­¾åˆ°æ€»æ¬¡æ•°</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure>

<p><strong>æŒ‰å¤©ç»Ÿè®¡ç½‘ç«™æ´»è·ƒç”¨æˆ·</strong></p>
<p>å¤©ä½œä¸ºkeyï¼Œç”¨æˆ·IDä¸ºoffsetï¼Œä¸Šçº¿ç½®ä¸º1</p>
<p>ä¸€äº¿ç”¨æˆ·ï¼Œè¿è¡Œä¸€å¤©å ç”¨çš„å†…å­˜ä¸º 1bit* 100000000 &#x3D; 100000000 &#x2F; 1024 &#x2F;1024&#x2F; 8MBï¼Œçº¦ä¸º12.5MB è¿è¡Œä¸€ä¸ªæœˆå ç”¨çš„å†…å­˜ä¸º375MBï¼Œä¸€å¹´å ç”¨çš„å†…å­˜å®¹é‡ä¸º4.5G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;SETBIT 20190601 5  1    #0000 0100</span><br><span class="line">&gt;SETBIT 20190602 7  1    #0000 0001 </span><br><span class="line">&gt;SETBIT 20190603 7  1    #0000 0001</span><br><span class="line"></span><br><span class="line">æ±‚6æœˆ1æ—¥åˆ°6æœˆ10æ—¥çš„æ´»è·ƒç”¨æˆ·æ•°</span><br><span class="line">&gt;BITOP OR users 20190601 20190602 20190603 ... 20190610</span><br><span class="line">&gt;BITCOUNT users    #ç›®æ ‡keyä¸ºusers ç»“æœä¸º2</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·åœ¨çº¿çŠ¶æ€ã€åœ¨çº¿äººæ•°ç»Ÿè®¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; SETBIT online 5  1 #0000 0100 ä¸Šçº¿ä¸º1</span><br><span class="line">(integer) 0</span><br><span class="line">&gt; SETBIT online 7  1 #0000 0101</span><br><span class="line">(integer) 0</span><br><span class="line">&gt; bitcount online #å½“å‰åœ¨çº¿äººæ•°</span><br><span class="line">(integer) 2 </span><br><span class="line">&gt; SETBIT online 7  0</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; bitcount online #å½“å‰åœ¨çº¿äººæ•°</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>



<h6 id="Redis-HyperLogLog"><a href="#Redis-HyperLogLog" class="headerlink" title="Redis HyperLogLog"></a>Redis HyperLogLog</h6><p>Redis åœ¨ 2.8.9 ç‰ˆæœ¬æ·»åŠ äº† HyperLogLog ç»“æ„ã€‚</p>
<p>Redis HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®š çš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚</p>
<p>åœ¨ Redis é‡Œé¢ï¼Œæ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸº æ•°ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆå½¢æˆé²œæ˜å¯¹æ¯”ã€‚</p>
<p>ä½†æ˜¯ï¼Œå› ä¸º HyperLogLog åªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå‚¨å­˜è¾“å…¥å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥ HyperLogLog ä¸èƒ½åƒé›†åˆé‚£æ ·ï¼Œè¿”å›è¾“å…¥çš„å„ä¸ªå…ƒç´ ã€‚</p>
<h6 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h6><p>Redis GEO ä¸»è¦ç”¨äºå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œå¹¶å¯¹å­˜å‚¨çš„ä¿¡æ¯è¿›è¡Œæ“ä½œï¼Œè¯¥åŠŸèƒ½åœ¨ Redis 3.2 ç‰ˆæœ¬æ–°å¢ã€‚</p>
<p>Redis GEO æ“ä½œæ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>geoaddï¼šæ·»åŠ åœ°ç†ä½ç½®çš„åæ ‡ã€‚</li>
<li>geoposï¼šè·å–åœ°ç†ä½ç½®çš„åæ ‡ã€‚</li>
<li>geodistï¼šè®¡ç®—ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„è·ç¦»ã€‚</li>
<li>georadiusï¼šæ ¹æ®ç”¨æˆ·ç»™å®šçš„ç»çº¬åº¦åæ ‡æ¥è·å–æŒ‡å®šèŒƒå›´å†…çš„åœ°ç†ä½ç½®é›†åˆã€‚</li>
<li>georadiusbymemberï¼šæ ¹æ®å‚¨å­˜åœ¨ä½ç½®é›†åˆé‡Œé¢çš„æŸä¸ªåœ°ç‚¹è·å–æŒ‡å®šèŒƒå›´å†…çš„åœ°ç†ä½ç½®é›†åˆã€‚</li>
<li>geohashï¼šè¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªä½ç½®å¯¹è±¡çš„ geohash å€¼ã€‚</li>
</ul>
<h3 id="4ã€å‘å¸ƒè®¢é˜…"><a href="#4ã€å‘å¸ƒè®¢é˜…" class="headerlink" title="4ã€å‘å¸ƒè®¢é˜…"></a>4ã€å‘å¸ƒè®¢é˜…</h3><p>Redis å‘å¸ƒè®¢é˜… (pub&#x2F;sub) æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€… (pub) å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€… (sub) æ¥æ”¶æ¶ˆæ¯ã€‚</p>
<p>Redis å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº†é¢‘é“ channel1 ï¼Œ ä»¥åŠè®¢é˜…è¿™ä¸ªé¢‘é“çš„ä¸‰ä¸ªå®¢æˆ·ç«¯ â€”â€” client2 ã€ client5 å’Œ client1 ä¹‹é—´çš„å…³ç³»ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.runoob.com/wp-content/uploads/2014/11/pubsub1.png" alt="img"></p>
<p>å½“æœ‰æ–°æ¶ˆæ¯é€šè¿‡ PUBLISH å‘½ä»¤å‘é€ç»™é¢‘é“ channel1 æ—¶ï¼Œ è¿™ä¸ªæ¶ˆæ¯å°±ä¼šè¢«å‘é€ç»™è®¢é˜…å®ƒçš„ä¸‰ä¸ªå®¢æˆ·ç«¯ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.runoob.com/wp-content/uploads/2014/11/pubsub2.png" alt="img"></p>
<p>å®ä¾‹</p>
<p>ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº†å‘å¸ƒè®¢é˜…æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œéœ€è¦å¼€å¯ä¸¤ä¸ª redis-cli å®¢æˆ·ç«¯ã€‚</p>
<p>ç¬¬ä¸€ä¸ª redis-cli å®¢æˆ·ç«¯ï¼ˆè®¢é˜…è€…ï¼‰</p>
<p>åœ¨æˆ‘ä»¬å®ä¾‹ä¸­æˆ‘ä»¬åˆ›å»ºäº†è®¢é˜…é¢‘é“åä¸º <strong>runoobChat</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; SUBSCRIBE runoobChat</span><br><span class="line"></span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;runoobChat&quot;</span><br><span class="line">3)(integer) 1</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆé‡æ–°å¼€å¯ä¸ª redis å®¢æˆ·ç«¯ï¼Œç„¶ååœ¨åŒä¸€ä¸ªé¢‘é“ runoobChat å‘å¸ƒä¸¤æ¬¡æ¶ˆæ¯ï¼Œè®¢é˜…è€…å°±èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚</p>
<p>ç¬¬äºŒä¸ª redis-cli å®¢æˆ·ç«¯ï¼ˆå‘å¸ƒè€…ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; PUBLISH runoobChat &quot;Redis PUBLISH test&quot;</span><br><span class="line">(integer) 1</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; PUBLISH runoobChat &quot;Learn redis by runoob.com&quot;</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<p>\è®¢é˜…è€…çš„å®¢æˆ·ç«¯ä¼šæ˜¾ç¤ºå¦‚ä¸‹æ¶ˆæ¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;runoobChat&quot;</span><br><span class="line">3) &quot;Redis PUBLISH test&quot;</span><br><span class="line"></span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;runoobChat&quot;</span><br><span class="line">3) &quot;Learn redis by runoob.com&quot;</span><br></pre></td></tr></table></figure>

<p>gif æ¼”ç¤ºå¦‚ä¸‹ï¼š</p>
<ul>
<li>å¼€å¯æœ¬åœ° Redis æœåŠ¡ï¼Œå¼€å¯ä¸¤ä¸ª redis-cli å®¢æˆ·ç«¯ã€‚</li>
<li>åœ¨<strong>ç¬¬ä¸€ä¸ª redis-cli å®¢æˆ·ç«¯</strong>è¾“å…¥ <strong>SUBSCRIBE runoobChat</strong>ï¼Œæ„æ€æ˜¯è®¢é˜… <code>runoobChat</code> é¢‘é“ã€‚</li>
<li>åœ¨<strong>ç¬¬äºŒä¸ª redis-cli å®¢æˆ·ç«¯</strong>è¾“å…¥ <strong>PUBLISH runoobChat â€œRedis PUBLISH testâ€</strong> å¾€ runoobChat é¢‘é“å‘é€æ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™åœ¨ç¬¬ä¸€ä¸ª redis-cli å®¢æˆ·ç«¯å°±ä¼šçœ‹åˆ°ç”±ç¬¬äºŒä¸ª redis-cli å®¢æˆ·ç«¯å‘é€çš„æµ‹è¯•æ¶ˆæ¯ã€‚</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.runoob.com/wp-content/uploads/2014/11/redis-pub-sub.gif" alt="img"></p>
<p>å‘½ä»¤</p>
<table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">å‘½ä»¤åŠæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">PSUBSCRIBE pattern [pattern â€¦] è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆç»™å®šæ¨¡å¼çš„é¢‘é“ã€‚</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">[PUBSUB subcommand <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-pubsub.html">argument [argument â€¦]]</a> æŸ¥çœ‹è®¢é˜…ä¸å‘å¸ƒç³»ç»ŸçŠ¶æ€ã€‚</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-publish.html">PUBLISH channel message</a> å°†ä¿¡æ¯å‘é€åˆ°æŒ‡å®šçš„é¢‘é“ã€‚</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">[PUNSUBSCRIBE <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-punsubscribe.html">pattern [pattern â€¦]]</a> é€€è®¢æ‰€æœ‰ç»™å®šæ¨¡å¼çš„é¢‘é“ã€‚</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">SUBSCRIBE channel [channel â€¦] è®¢é˜…ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“çš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">[UNSUBSCRIBE <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/pub-sub-unsubscribe.html">channel [channel â€¦]]</a> æŒ‡é€€è®¢ç»™å®šçš„é¢‘é“ã€‚</td>
</tr>
</tbody></table>
<h3 id="5ã€Java-ä½¿ç”¨-Redis-Jedis"><a href="#5ã€Java-ä½¿ç”¨-Redis-Jedis" class="headerlink" title="5ã€Java ä½¿ç”¨ Redis(Jedis)"></a>5ã€Java ä½¿ç”¨ Redis(Jedis)</h3><p><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/redis-java.html">æ¡ˆä¾‹</a></p>
<h3 id="6ã€Redisä¸Spring-Bootæ•´åˆ"><a href="#6ã€Redisä¸Spring-Bootæ•´åˆ" class="headerlink" title="6ã€Redisä¸Spring Bootæ•´åˆ"></a>6ã€<strong>Redisä¸Spring Bootæ•´åˆ</strong></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- spring2.Xé›†æˆredisæ‰€éœ€common-pool2--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>application.propertiesé…ç½®redisé…ç½®</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#RedisæœåŠ¡å™¨åœ°å€</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">192.168.140.136</span></span><br><span class="line"><span class="comment">#RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment">#Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span></span><br><span class="line"><span class="attr">spring.redis.database</span>= <span class="string">0</span></span><br><span class="line"><span class="comment">#è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line"><span class="attr">spring.redis.timeout</span>=<span class="string">1800000</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-active</span>=<span class="string">20</span></span><br><span class="line"><span class="comment">#æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´(è´Ÿæ•°è¡¨ç¤ºæ²¡é™åˆ¶)</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-idle</span>=<span class="string">5</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure>

<p><strong>é…ç½®ç±»</strong>ï¼Œä¸€èˆ¬è‡ªå®šä¹‰é…ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">		<span class="comment">//keyåºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        template.setKeySerializer(redisSerializer);</span><br><span class="line">		<span class="comment">//valueåºåˆ—åŒ–</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">		<span class="comment">//value hashmapåºåˆ—åŒ–</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);</span><br><span class="line">		<span class="comment">//è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">		<span class="comment">// é…ç½®åºåˆ—åŒ–ï¼ˆè§£å†³ä¹±ç çš„é—®é¢˜ï¼‰,è¿‡æœŸæ—¶é—´600ç§’</span></span><br><span class="line">        <span class="type">RedisCacheConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        <span class="type">RedisCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> RedisCacheManager.builder(factory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç®€å•ä½¿ç”¨redis</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;redis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">saveRedis</span><span class="params">()</span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;springboot:redis:name&quot;</span>,<span class="string">&quot;promsing&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;springboot:redis:name&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;redisä¸­å­˜å‚¨çš„å†…å®¹&quot;</span>+o);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> o.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = UserApplication.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;<span class="comment">//å­˜å‚¨çš„æ•°æ®è¿›è¡Œäº†åºåˆ—åŒ–,å»ºè®®ä½¿ç”¨å®ƒ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate2;<span class="comment">//å­˜å‚¨çš„æ•°æ®æ²¡æœ‰ç»™åºåˆ—åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRedis</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å­˜å‚¨æ•°æ®</span></span><br><span class="line">        <span class="built_in">this</span>.redisTemplate.opsForValue().set(<span class="string">&quot;key2&quot;</span>, <span class="string">&quot;value2&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> <span class="built_in">this</span>.redisTemplate.opsForValue().get(<span class="string">&quot;key2&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;val = &quot;</span> + val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRedis2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å­˜å‚¨æ•°æ®ï¼Œå¹¶æŒ‡å®šå‰©ä½™ç”Ÿå‘½æ—¶é—´,5å°æ—¶</span></span><br><span class="line">        <span class="built_in">this</span>.redisTemplate.opsForValue().set(<span class="string">&quot;key2&quot;</span>, <span class="string">&quot;value2&quot;</span>,</span><br><span class="line">                <span class="number">5</span>, TimeUnit.HOURS); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">        BoundHashOperations&lt;String, Object, Object&gt; hashOps =</span><br><span class="line">                <span class="built_in">this</span>.redisTemplate.boundHashOps(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="comment">// æ“ä½œhashæ•°æ®</span></span><br><span class="line">        hashOps.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;jack&quot;</span>);</span><br><span class="line">        hashOps.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;21&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å•ä¸ªæ•°æ®</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> hashOps.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰æ•°æ®</span></span><br><span class="line">        Map&lt;Object, Object&gt; map = hashOps.entries();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Object, Object&gt; me : map.entrySet()) &#123;</span><br><span class="line">            System.out.println(me.getKey() + <span class="string">&quot; : &quot;</span> + me.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/redis/docs/current/api/org/springframework/data/redis/core/RedisTemplate.html">æ›´å¤šæ“ä½œAPI</a></p>
<h3 id="7ã€Redisäº‹åŠ¡"><a href="#7ã€Redisäº‹åŠ¡" class="headerlink" title="7ã€Redisäº‹åŠ¡"></a>7ã€Redisäº‹åŠ¡</h3><p>Redis äº‹åŠ¡å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œ å¹¶ä¸”å¸¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªé‡è¦çš„ä¿è¯ï¼š</p>
<ul>
<li>æ‰¹é‡æ“ä½œåœ¨å‘é€ EXEC å‘½ä»¤å‰è¢«æ”¾å…¥é˜Ÿåˆ—ç¼“å­˜ã€‚</li>
<li>æ”¶åˆ° EXEC å‘½ä»¤åè¿›å…¥äº‹åŠ¡æ‰§è¡Œï¼Œäº‹åŠ¡ä¸­ä»»æ„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶ä½™çš„å‘½ä»¤ä¾ç„¶è¢«æ‰§è¡Œã€‚</li>
<li>åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åºåˆ—ä¸­ã€‚</li>
</ul>
<p>ä¸€ä¸ªäº‹åŠ¡ä»å¼€å§‹åˆ°æ‰§è¡Œä¼šç»å†ä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>å¼€å§‹äº‹åŠ¡ã€‚MULTI</li>
<li>å‘½ä»¤å…¥é˜Ÿã€‚ç»„é˜Ÿé˜¶æ®µå‡ºç°é”™è¯¯ï¼Œæäº¤ä¼šå¤±è´¥</li>
<li>æ‰§è¡Œäº‹åŠ¡ã€‚EXEC</li>
</ul>
<p>å®ä¾‹</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„ä¾‹å­ï¼Œ å®ƒå…ˆä»¥ <strong>MULTI</strong> å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œ ç„¶åå°†å¤šä¸ªå‘½ä»¤å…¥é˜Ÿåˆ°äº‹åŠ¡ä¸­ï¼Œ æœ€åç”± <strong>EXEC</strong> å‘½ä»¤è§¦å‘äº‹åŠ¡ï¼Œ ä¸€å¹¶æ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; SET book-name &quot;Mastering C++ in 21 days&quot;</span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; GET book-name</span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; SADD tag &quot;C++&quot; &quot;Programming&quot; &quot;Mastering Series&quot;</span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; SMEMBERS tag</span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) OK</span><br><span class="line">2) &quot;Mastering C++ in 21 days&quot;</span><br><span class="line">3) (integer) 3</span><br><span class="line">4) 1) &quot;Mastering Series&quot;</span><br><span class="line">   2) &quot;C++&quot;</span><br><span class="line">   3) &quot;Programming&quot;</span><br></pre></td></tr></table></figure>

<p>å•ä¸ª Redis å‘½ä»¤çš„æ‰§è¡Œæ˜¯åŸå­æ€§çš„ï¼Œä½† Redis æ²¡æœ‰åœ¨äº‹åŠ¡ä¸Šå¢åŠ ä»»ä½•ç»´æŒåŸå­æ€§çš„æœºåˆ¶ï¼Œæ‰€ä»¥ Redis äº‹åŠ¡çš„æ‰§è¡Œå¹¶ä¸æ˜¯åŸå­æ€§çš„ã€‚</p>
<p>äº‹åŠ¡å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ‰“åŒ…çš„æ‰¹é‡æ‰§è¡Œè„šæœ¬ï¼Œä½†æ‰¹é‡æŒ‡ä»¤å¹¶éåŸå­åŒ–çš„æ“ä½œï¼Œä¸­é—´æŸæ¡æŒ‡ä»¤çš„å¤±è´¥ä¸ä¼šå¯¼è‡´å‰é¢å·²åšæŒ‡ä»¤çš„å›æ»šï¼Œä¹Ÿä¸ä¼šé€ æˆåç»­çš„æŒ‡ä»¤ä¸åšã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; SET book-name &quot;Mastering C++ in 21 days&quot;</span><br><span class="line">QUEUED</span><br><span class="line">redis 127.0.0.1:6379&gt; INCR book_name</span><br><span class="line">QUEUED</span><br><span class="line">redis 127.0.0.1:6379&gt; SET K2 V2</span><br><span class="line">QUEUE</span><br><span class="line">redis 127.0.0.1:6379&gt; EXEC</span><br><span class="line">ok</span><br><span class="line">error #ä¸ä¼šå‘ç”Ÿå›æ»š</span><br><span class="line">ok</span><br></pre></td></tr></table></figure>

<p>ç»„é˜Ÿå¤±è´¥çš„æƒ…å†µ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; SET book-name &quot;Mastering C++ in 21 days&quot;</span><br><span class="line">QUEUED</span><br><span class="line">redis 127.0.0.1:6379&gt; SET K1 </span><br><span class="line">ERROR</span><br><span class="line">redis 127.0.0.1:6379&gt; SET K2 V2</span><br><span class="line">QUEUE</span><br><span class="line">redis 127.0.0.1:6379&gt; EXEC</span><br><span class="line">ERROR</span><br></pre></td></tr></table></figure>

<p>ä¸‹è¡¨åˆ—å‡ºäº† redis äº‹åŠ¡çš„ç›¸å…³å‘½ä»¤ï¼š</p>
<table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">å‘½ä»¤åŠæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/transactions-discard.html">DISCARD</a> å–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—å†…çš„æ‰€æœ‰å‘½ä»¤ã€‚</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/transactions-exec.html">EXEC</a> æ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤ã€‚</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/transactions-multi.html">MULTI</a> æ ‡è®°ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹ã€‚</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/transactions-unwatch.html">UNWATCH</a> å–æ¶ˆ WATCH å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†ã€‚</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">WATCH key [key â€¦]ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚åŠ äº†ä¹è§‚é”</td>
</tr>
</tbody></table>
<blockquote>
<p>springbootæ•´åˆredisçš„æ—¶å€™ä¸è¦åœ¨äº‹åŠ¡ä¸­åšæŸ¥è¯¢ï¼Œå› ä¸ºä¸ä¼šé©¬ä¸Šæœ‰ç»“æœ</p>
</blockquote>
<h3 id="8ã€Redisè„šæœ¬-Lua"><a href="#8ã€Redisè„šæœ¬-Lua" class="headerlink" title="8ã€Redisè„šæœ¬(Lua)"></a>8ã€Redisè„šæœ¬(Lua)</h3><p>Redis è„šæœ¬ä½¿ç”¨ Lua è§£é‡Šå™¨æ¥æ‰§è¡Œè„šæœ¬ã€‚ Redis 2.6 ç‰ˆæœ¬é€šè¿‡å†…åµŒæ”¯æŒ Lua ç¯å¢ƒã€‚æ‰§è¡Œè„šæœ¬çš„å¸¸ç”¨å‘½ä»¤ä¸º <strong>EVAL</strong>ã€‚</p>
<p>è¯­æ³•</p>
<p>Eval å‘½ä»¤çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; EVAL script numkeys key [key ...] arg [arg ...]</span><br></pre></td></tr></table></figure>

<p>å®ä¾‹</p>
<p>ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº† redis è„šæœ¬å·¥ä½œè¿‡ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; EVAL &quot;return &#123;KEYS[1],KEYS[2],ARGV[1],ARGV[2]&#125;&quot; 2 key1 key2 first second</span><br><span class="line"></span><br><span class="line">1) &quot;key1&quot;</span><br><span class="line">2) &quot;key2&quot;</span><br><span class="line">3) &quot;first&quot;</span><br><span class="line">4) &quot;second&quot;</span><br></pre></td></tr></table></figure>

<p>Redis è„šæœ¬å‘½ä»¤</p>
<p>ä¸‹è¡¨åˆ—å‡ºäº† redis è„šæœ¬å¸¸ç”¨å‘½ä»¤ï¼š</p>
<table>
<thead>
<tr>
<th align="left">åºå·</th>
<th align="left">å‘½ä»¤åŠæè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">[EVAL script numkeys key <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/scripting-eval.html">key â€¦] arg [arg â€¦]</a> æ‰§è¡Œ Lua è„šæœ¬ã€‚</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">[EVALSHA sha1 numkeys key <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/scripting-evalsha.html">key â€¦] arg [arg â€¦]</a> æ‰§è¡Œ Lua è„šæœ¬ã€‚</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">SCRIPT EXISTS script [script â€¦]æŸ¥çœ‹æŒ‡å®šçš„è„šæœ¬æ˜¯å¦å·²ç»è¢«ä¿å­˜åœ¨ç¼“å­˜å½“ä¸­ã€‚</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/scripting-script-flush.html">SCRIPT FLUSH</a> ä»è„šæœ¬ç¼“å­˜ä¸­ç§»é™¤æ‰€æœ‰è„šæœ¬ã€‚</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/scripting-script-kill.html">SCRIPT KILL</a> æ€æ­»å½“å‰æ­£åœ¨è¿è¡Œçš„ Lua è„šæœ¬ã€‚</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/scripting-script-load.html">SCRIPT LOAD script</a> å°†è„šæœ¬ script æ·»åŠ åˆ°è„šæœ¬ç¼“å­˜ä¸­ï¼Œä½†å¹¶ä¸ç«‹å³æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚</td>
</tr>
</tbody></table>
<h3 id="9ã€æŒä¹…åŒ–"><a href="#9ã€æŒä¹…åŒ–" class="headerlink" title="9ã€æŒä¹…åŒ–"></a>9ã€æŒä¹…åŒ–</h3><h4 id="9-1-AOF"><a href="#9-1-AOF" class="headerlink" title="9.1 AOF"></a>9.1 AOF</h4><p>AOF æŒä¹…åŒ–è®°å½•æœåŠ¡å™¨æ‰§è¡Œçš„<strong>æ‰€æœ‰å†™æ“ä½œå‘½ä»¤</strong>ï¼Œå¹¶åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œé€šè¿‡é‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥è¿˜åŸæ•°æ®é›†ã€‚ AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤å…¨éƒ¨ä»¥ Redis åè®®çš„æ ¼å¼æ¥ä¿å­˜ï¼Œæ–°å‘½ä»¤ä¼šè¢«è¿½åŠ åˆ°æ–‡ä»¶çš„æœ«å°¾ã€‚AOFæ˜¯å†™åæ—¥å¿—ï¼Œ<strong>â€œå†™åâ€</strong>çš„æ„æ€æ˜¯ Redis æ˜¯å…ˆæ‰§è¡Œå‘½ä»¤ï¼ŒæŠŠæ•°æ®å†™å…¥å†…å­˜ï¼Œç„¶åæ‰è®°å½•æ—¥å¿—,å‘½ä»¤æ‰§è¡Œåæ‰è®°å½•æ—¥å¿—ï¼Œæ‰€ä»¥ä¸ä¼šé˜»å¡å½“å‰çš„å†™æ“ä½œã€‚</p>
<p>å¦‚æœå…ˆè®°æ—¥å¿—å†æ‰§è¡Œå‘½ä»¤çš„è¯ï¼Œæ—¥å¿—ä¸­å°±æœ‰å¯èƒ½è®°å½•äº†é”™è¯¯çš„å‘½ä»¤ï¼ŒRedis åœ¨ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±å¯èƒ½ä¼šå‡ºé”™ã€‚</p>
<p>åå†™é¿å…äº†å¯¹å½“å‰å‘½ä»¤çš„é˜»å¡ï¼Œä½†å¯èƒ½ä¼š<code>ç»™ä¸‹ä¸€ä¸ªæ“ä½œå¸¦æ¥é˜»å¡é£é™©</code>ã€‚è¿™æ˜¯å› ä¸ºï¼Œ<strong>AOF æ—¥å¿—ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„</strong>ï¼Œå¦‚æœåœ¨æŠŠæ—¥å¿—æ–‡ä»¶å†™å…¥ç£ç›˜æ—¶ï¼Œç£ç›˜å†™å‹åŠ›å¤§ï¼Œå°±ä¼šå¯¼è‡´å†™ç›˜å¾ˆæ…¢ï¼Œè¿›è€Œå¯¼è‡´åç»­çš„æ“ä½œä¹Ÿæ— æ³•æ‰§è¡Œäº†ã€‚</p>
<p><code>Redis è¿˜å¯ä»¥åœ¨åå°å¯¹ AOF æ–‡ä»¶è¿›è¡Œé‡å†™ï¼ˆrewriteï¼‰</code>ï¼Œä½¿å¾— AOF æ–‡ä»¶çš„ä½“ç§¯ä¸ä¼šè¶…å‡ºä¿å­˜æ•°æ®é›†çŠ¶æ€æ‰€éœ€çš„å®é™…å¤§å°ã€‚</p>
<p>Redis è¿˜å¯ä»¥åŒæ—¶ä½¿ç”¨ AOF æŒä¹…åŒ–å’Œ RDB æŒä¹…åŒ–ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ å½“ Redis é‡å¯æ—¶ï¼Œ å®ƒä¼š<strong>ä¼˜å…ˆä½¿ç”¨ AOF æ–‡ä»¶æ¥è¿˜åŸæ•°æ®é›†</strong>ï¼Œ å› ä¸º AOF æ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†é€šå¸¸æ¯” RDB æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®é›†æ›´å®Œæ•´ã€‚ä½ ç”šè‡³å¯ä»¥å…³é—­æŒä¹…åŒ–åŠŸèƒ½ï¼Œè®©æ•°æ®åªåœ¨æœåŠ¡å™¨è¿è¡Œæ—¶å­˜åœ¨ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æ‰“å¼€ AOF åŠŸèƒ½ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<p><strong>æ—¥å¿—é‡å†™</strong></p>
<p>ä½ å¯ä»¥çŒœå¾—åˆ°ï¼Œå†™æ“ä½œä¸æ–­æ‰§è¡Œçš„æ—¶å€™AOFæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å¢åŠ ä¸€ä¸ªè®¡æ•°å™¨100æ¬¡ï¼Œä½ çš„æ•°æ®é›†é‡Œåªä¼šæœ‰ä¸€ä¸ªé”®å­˜å‚¨è¿™æœ€ç»ˆå€¼ï¼Œä½†æ˜¯å´æœ‰100æ¡è®°å½•åœ¨AOFä¸­ã€‚å…¶ä¸­99æ¡è®°å½•åœ¨é‡å»ºå½“å‰çŠ¶æ€æ—¶æ˜¯ä¸éœ€è¦çš„ã€‚</p>
<p>äºæ˜¯Redisæ”¯æŒä¸€ä¸ªæœ‰è¶£çš„ç‰¹æ€§ï¼šåœ¨åå°é‡å»ºAOFè€Œä¸å½±å“æœåŠ¡å®¢æˆ·ç«¯ã€‚æ¯å½“ä½ å‘é€BGREWRITEAOFæ—¶ï¼ŒRediså°†ä¼šå†™å…¥ä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶ï¼ŒåŒ…å«é‡å»ºå½“å‰å†…å­˜ä¸­æ•°æ®é›†æ‰€éœ€çš„æœ€çŸ­å‘½ä»¤åºåˆ—ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Redis 2.2çš„AOFï¼Œä½ éœ€è¦ä¸æ—¶çš„è¿è¡Œ<code>BGREWRITEAOF</code>å‘½ä»¤ã€‚Redis 2.4å¯ä»¥è‡ªåŠ¨è§¦å‘æ—¥å¿—é‡å†™(æŸ¥çœ‹Redis 2.4ä¸­çš„ç¤ºä¾‹é…ç½®æ–‡ä»¶ä»¥è·å¾—æ›´å¤šä¿¡æ¯)ã€‚</p>
<p>Redisä¼šè®°å½•ä¸Šæ¬¡é‡å†™æ—¶çš„AOFå¤§å°ï¼Œé»˜è®¤é…ç½®æ˜¯å½“AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡rewriteåå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº64Mæ—¶è§¦å‘</p>
<p><strong>AOF3ç§å†™ç›˜ç­–ç•¥</strong></p>
<p>ä½ å¯ä»¥é…ç½® Redis å¤šä¹…æ‰å°†æ•°æ® fsync åˆ°ç£ç›˜ä¸€æ¬¡ã€‚æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼š</p>
<ul>
<li>æ¯æ¬¡æœ‰æ–°å‘½ä»¤è¿½åŠ åˆ° AOF æ–‡ä»¶æ—¶å°±æ‰§è¡Œä¸€æ¬¡ fsync ï¼šéå¸¸æ…¢ï¼Œä¹Ÿéå¸¸å®‰å…¨ã€‚</li>
<li>æ¯ç§’ fsync ä¸€æ¬¡ï¼šè¶³å¤Ÿå¿«ï¼ˆå’Œä½¿ç”¨ RDB æŒä¹…åŒ–å·®ä¸å¤šï¼‰ï¼Œå¹¶ä¸”åœ¨æ•…éšœæ—¶åªä¼š<code>ä¸¢å¤± 1 ç§’é’Ÿ</code>çš„æ•°æ®ã€‚</li>
<li>ä»ä¸ fsync ï¼šå°†æ•°æ®äº¤ç»™æ“ä½œç³»ç»Ÿæ¥å¤„ç†ã€‚æ›´å¿«ï¼Œä¹Ÿæ›´ä¸å®‰å…¨çš„é€‰æ‹©ã€‚</li>
</ul>
<p>æ¨èï¼ˆå¹¶ä¸”ä¹Ÿæ˜¯é»˜è®¤ï¼‰çš„æªæ–½ä¸ºæ¯ç§’ fsync ä¸€æ¬¡ï¼Œ è¿™ç§ fsync ç­–ç•¥å¯ä»¥å…¼é¡¾é€Ÿåº¦å’Œå®‰å…¨æ€§ã€‚ æ€»æ˜¯ fsync çš„ç­–ç•¥åœ¨å®é™…ä½¿ç”¨ä¸­éå¸¸æ…¢ï¼Œ å³ä½¿åœ¨ Redis 2.0 å¯¹ç›¸å…³çš„ç¨‹åºè¿›è¡Œäº†æ”¹è¿›ä¹‹åä»æ˜¯å¦‚æ­¤ â€”â€” é¢‘ç¹è°ƒç”¨ fsync æ³¨å®šäº†è¿™ç§ç­–ç•¥ä¸å¯èƒ½å¿«å¾—èµ·æ¥ã€‚</p>
<p>å½“ä½¿ç”¨Alwaysç­–ç•¥æ—¶ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œå®Œå‘½ä»¤ä¹‹åï¼Œä¼šè°ƒç”¨fsync()å‡½æ•°ï¼ŒæŠŠç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°ç¡¬ç›˜çš„aofæ–‡ä»¶ï¼Œç­‰åˆ°ç¡¬ç›˜æ“ä½œå¾€ä¹‹åå‡½æ•°æ‰ä¼šè¿”å›ï¼Œå¦‚æœå†™å…¥çš„æ˜¯ä¸€ä¸ªå¤§keyï¼Œä¸»çº¿ç¨‹åœ¨æ‰§è¡Œfsync()çš„æ—¶å€™å°±ä¼šè¢«é˜»å¡æ¯”è¾ƒä¹…ã€‚</p>
<blockquote>
<p>å¤§keyæ˜¯æŒ‡keyå¯¹åº”çš„valueå¾ˆå¤§</p>
<p>å¯¹äºstringç±»å‹ å€¼&gt;10kb</p>
<p>hash list,set, zset ç±»å‹çš„å…ƒç´ ä¸ªæ•°è¶…é«˜5000ä¸ª</p>
</blockquote>
<p><strong>å¦‚æœ AOF æ–‡ä»¶å‡ºé”™äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</strong></p>
<p>æœåŠ¡å™¨å¯èƒ½åœ¨ç¨‹åºæ­£åœ¨å¯¹ AOF æ–‡ä»¶è¿›è¡Œå†™å…¥æ—¶å´©æºƒï¼ˆè¿™ä¸ªä¸åº”è¯¥ç ´åæ•°æ®çš„ä¸€è‡´æ€§ï¼‰ï¼Œ Redisä¸ä¼šè£…è½½å·²ç ´åçš„AOFæ–‡ä»¶ã€‚å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œ å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ä¿®å¤å‡ºé”™çš„ AOF æ–‡ä»¶ï¼š</p>
<ul>
<li>ä¸ºç°æœ‰çš„ AOF æ–‡ä»¶åˆ›å»ºä¸€ä¸ªå¤‡ä»½ã€‚</li>
<li>ä½¿ç”¨ Redis é™„å¸¦çš„ redis-check-aof ç¨‹åºï¼Œå¯¹åŸæ¥çš„ AOF æ–‡ä»¶è¿›è¡Œä¿®å¤ã€‚</li>
<li>$ redis-check-aof â€“fix</li>
<li>ï¼ˆå¯é€‰ï¼‰ä½¿ç”¨ diff -u å¯¹æ¯”ä¿®å¤åçš„ AOF æ–‡ä»¶å’ŒåŸå§‹ AOF æ–‡ä»¶çš„å¤‡ä»½ï¼ŒæŸ¥çœ‹ä¸¤ä¸ªæ–‡ä»¶ä¹‹é—´çš„ä¸åŒä¹‹å¤„ã€‚</li>
<li>é‡å¯ Redis æœåŠ¡å™¨ï¼Œç­‰å¾…æœåŠ¡å™¨è½½å…¥ä¿®å¤åçš„ AOF æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œæ•°æ®æ¢å¤ã€‚</li>
</ul>
<p><strong>é‡å†™å¦‚ä½•å·¥ä½œ</strong></p>
<p>æ—¥å¿—é‡å†™é‡‡ç”¨äº†å’Œå¿«ç…§ä¸€æ ·çš„å†™æ—¶å¤åˆ¶æœºåˆ¶ã€‚ä¸‹é¢æ˜¯è¿‡ç¨‹ï¼š</p>
<ul>
<li>Redisè°ƒç”¨fork()ã€‚äºæ˜¯æˆ‘ä»¬æœ‰äº†çˆ¶å­ä¸¤ä¸ªè¿›ç¨‹ã€‚</li>
<li>å­è¿›ç¨‹å¼€å§‹å‘ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­å†™AOFã€‚</li>
<li>çˆ¶è¿›ç¨‹åœ¨ä¸€ä¸ªå†…å­˜ç¼“å†²åŒºä¸­ç§¯ç´¯æ–°çš„å˜æ›´(åŒæ—¶å°†æ–°çš„å˜æ›´å†™å…¥æ—§çš„AOFæ–‡ä»¶ï¼Œæ‰€ä»¥å³ä½¿é‡å†™å¤±è´¥æˆ‘ä»¬ä¹Ÿå®‰å…¨)ã€‚</li>
<li>å½“å­è¿›ç¨‹å®Œæˆé‡å†™æ–‡ä»¶ï¼Œçˆ¶è¿›ç¨‹æ”¶åˆ°ä¸€ä¸ªä¿¡å·ï¼Œè¿½åŠ å†…å­˜ç¼“å†²åŒºåˆ°å­è¿›ç¨‹åˆ›å»ºçš„æ–‡ä»¶æœ«å°¾ã€‚</li>
<li>æå®šï¼ç°åœ¨RedisåŸå­æ€§åœ°é‡å‘½åæ—§æ–‡ä»¶ä¸ºæ–°çš„ï¼Œç„¶åå¼€å§‹è¿½åŠ æ–°æ•°æ®åˆ°æ–°æ–‡ä»¶ã€‚</li>
</ul>
<p>AOFé‡å†™æ˜¯éé˜»å¡çš„ï¼Œå’Œ AOF æ—¥å¿—ç”±ä¸»çº¿ç¨‹å†™å›ä¸åŒï¼Œé‡å†™è¿‡ç¨‹æ˜¯ç”±åå°çº¿ç¨‹ bgrewriteaof æ¥å®Œæˆçš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´æ•°æ®åº“æ€§èƒ½ä¸‹é™ã€‚</p>
<p>æˆ‘æŠŠé‡å†™çš„è¿‡ç¨‹æ€»ç»“ä¸º<strong>â€œä¸€ä¸ªæ‹·è´ï¼Œä¸¤å¤„æ—¥å¿—â€</strong>ã€‚</p>
<p>â€œä¸€ä¸ªæ‹·è´â€å°±æ˜¯æŒ‡ï¼Œæ¯æ¬¡æ‰§è¡Œé‡å†™æ—¶ï¼Œä¸»çº¿ç¨‹ fork å‡ºåå°çš„ bgrewriteaof å­è¿›ç¨‹ã€‚æ­¤æ—¶ï¼Œfork ä¼šæŠŠä¸»çº¿ç¨‹çš„å†…å­˜æ‹·è´ä¸€ä»½ç»™ bgrewriteaof å­è¿›ç¨‹ï¼Œè¿™é‡Œé¢å°±åŒ…å«äº†æ•°æ®åº“çš„æœ€æ–°æ•°æ®ã€‚ç„¶åï¼Œbgrewriteaof å­è¿›ç¨‹å°±å¯ä»¥åœ¨ä¸å½±å“ä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œé€ä¸€æŠŠæ‹·è´çš„æ•°æ®å†™æˆæ“ä½œï¼Œè®°å…¥é‡å†™æ—¥å¿—ã€‚</p>
<p>â€œä¸¤å¤„æ—¥å¿—â€åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å› ä¸ºä¸»çº¿ç¨‹æœªé˜»å¡ï¼Œä»ç„¶å¯ä»¥å¤„ç†æ–°æ¥çš„æ“ä½œã€‚æ­¤æ—¶ï¼Œå¦‚æœæœ‰å†™æ“ä½œï¼Œç¬¬ä¸€å¤„æ—¥å¿—å°±æ˜¯æŒ‡æ­£åœ¨ä½¿ç”¨çš„ AOF æ—¥å¿—ï¼ŒRedis ä¼šæŠŠè¿™ä¸ªæ“ä½œå†™åˆ°å®ƒçš„ç¼“å†²åŒºã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿å®•æœºäº†ï¼Œè¿™ä¸ª AOF æ—¥å¿—çš„æ“ä½œä»ç„¶æ˜¯é½å…¨çš„ï¼Œå¯ä»¥ç”¨äºæ¢å¤ã€‚</p>
<p>è€Œç¬¬äºŒå¤„æ—¥å¿—ï¼Œå°±æ˜¯æŒ‡æ–°çš„ AOF é‡å†™æ—¥å¿—ã€‚è¿™ä¸ªæ“ä½œä¹Ÿä¼šè¢«å†™åˆ°é‡å†™æ—¥å¿—çš„ç¼“å†²åŒºã€‚è¿™æ ·ï¼Œé‡å†™æ—¥å¿—ä¹Ÿä¸ä¼šä¸¢å¤±æœ€æ–°çš„æ“ä½œã€‚ç­‰åˆ°æ‹·è´æ•°æ®çš„æ‰€æœ‰æ“ä½œè®°å½•é‡å†™å®Œæˆåï¼Œé‡å†™æ—¥å¿—è®°å½•çš„è¿™äº›æœ€æ–°æ“ä½œä¹Ÿä¼šå†™å…¥æ–°çš„ AOF æ–‡ä»¶ï¼Œä»¥ä¿è¯æ•°æ®åº“æœ€æ–°çŠ¶æ€çš„è®°å½•ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æ–°çš„ AOF æ–‡ä»¶æ›¿ä»£æ—§æ–‡ä»¶äº†ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/YuChaoM/images/OS/image-20220912153729399.png" alt="image-20220912153729399"></p>
<p><strong>AOF çš„ä¼˜ç‚¹:</strong></p>
<ul>
<li>ä½¿ç”¨AOF Redisä¼šæ›´å…·æœ‰å¯æŒä¹…æ€§(durable)ï¼šä½ å¯ä»¥æœ‰å¾ˆå¤šä¸åŒçš„fsyncç­–ç•¥ï¼šæ²¡æœ‰fsyncï¼Œæ¯ç§’fsyncï¼Œæ¯æ¬¡è¯·æ±‚æ—¶fsyncã€‚ä½¿ç”¨<strong>é»˜è®¤çš„æ¯ç§’fsync</strong>ç­–ç•¥ï¼Œå†™æ€§èƒ½ä¹Ÿä»ç„¶å¾ˆä¸é”™(fsyncæ˜¯ç”±åå°çº¿ç¨‹å®Œæˆçš„ï¼Œä¸»çº¿ç¨‹ç»§ç»­åŠªåŠ›åœ°æ‰§è¡Œå†™è¯·æ±‚)ï¼Œå³ä¾¿ä½ ä¹Ÿå°±ä»…ä»…åªæŸå¤±ä¸€ç§’é’Ÿçš„å†™æ•°æ®ã€‚</li>
<li>AOFæ—¥å¿—æ˜¯ä¸€ä¸ªè¿½åŠ æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸éœ€è¦å®šä½ï¼Œåœ¨æ–­ç”µæ—¶ä¹Ÿæ²¡æœ‰æŸåé—®é¢˜ã€‚å³ä½¿ç”±äºæŸç§åŸå› æ–‡ä»¶æœ«å°¾æ˜¯ä¸€ä¸ªå†™åˆ°ä¸€åŠçš„å‘½ä»¤(ç£ç›˜æ»¡æˆ–è€…å…¶ä»–åŸå› ),redis-check-aofå·¥å…·ä¹Ÿå¯ä»¥å¾ˆè½»æ˜“çš„ä¿®å¤ã€‚</li>
<li>å½“AOFæ–‡ä»¶å˜å¾—å¾ˆå¤§æ—¶ï¼ŒRedisä¼šè‡ªåŠ¨åœ¨åå°è¿›è¡Œé‡å†™ã€‚é‡å†™æ˜¯ç»å¯¹å®‰å…¨çš„ï¼Œå› ä¸ºRedisç»§ç»­å¾€æ—§çš„æ–‡ä»¶ä¸­è¿½åŠ ï¼Œä½¿ç”¨åˆ›å»ºå½“å‰æ•°æ®é›†æ‰€éœ€çš„æœ€å°æ“ä½œé›†åˆæ¥åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„æ–‡ä»¶ï¼Œä¸€æ—¦ç¬¬äºŒä¸ªæ–‡ä»¶åˆ›å»ºå®Œæ¯•ï¼ŒRediså°±ä¼šåˆ‡æ¢è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¹¶å¼€å§‹å¾€æ–°æ–‡ä»¶è¿½åŠ ã€‚</li>
<li>AOFæ–‡ä»¶é‡Œé¢åŒ…å«ä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ“ä½œï¼Œä»¥æ˜“äºç†è§£å’Œè§£æçš„æ ¼å¼å­˜å‚¨ã€‚ä½ ä¹Ÿå¯ä»¥è½»æ˜“çš„å¯¼å‡ºä¸€ä¸ªAOFæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå³ä½¿ä½ ä¸å°å¿ƒé”™è¯¯åœ°ä½¿ç”¨FLUSHALLå‘½ä»¤æ¸…ç©ºä¸€åˆ‡ï¼Œå¦‚æœæ­¤æ—¶å¹¶æ²¡æœ‰æ‰§è¡Œé‡å†™ï¼Œä½ ä»ç„¶å¯ä»¥ä¿å­˜ä½ çš„æ•°æ®é›†ï¼Œä½ åªè¦åœæ­¢æœåŠ¡å™¨ï¼Œåˆ é™¤æœ€åä¸€æ¡å‘½ä»¤ï¼Œç„¶åé‡å¯Rediså°±å¯ä»¥ã€‚</li>
</ul>
<p><strong>AOF çš„ç¼ºç‚¹:</strong></p>
<ul>
<li>å¯¹åŒæ ·çš„æ•°æ®é›†ï¼ŒAOFæ–‡ä»¶é€šå¸¸è¦å¤§äºç­‰ä»·çš„RDBæ–‡ä»¶ã€‚</li>
<li>AOFå¯èƒ½æ¯”RDBæ…¢ï¼Œè¿™å–å†³äºå‡†ç¡®çš„fsyncç­–ç•¥ã€‚é€šå¸¸fsyncè®¾ç½®ä¸ºæ¯ç§’ä¸€æ¬¡çš„è¯æ€§èƒ½ä»ç„¶å¾ˆé«˜ï¼Œå¦‚æœå…³é—­fsyncï¼Œå³ä½¿åœ¨å¾ˆé«˜çš„è´Ÿè½½ä¸‹ä¹Ÿå’ŒRDBä¸€æ ·çš„å¿«ã€‚ä¸è¿‡ï¼Œå³ä½¿åœ¨å¾ˆå¤§çš„å†™è´Ÿè½½æƒ…å†µä¸‹ï¼ŒRDBè¿˜æ˜¯èƒ½æä¾›èƒ½å¥½çš„æœ€å¤§å»¶è¿Ÿä¿è¯ã€‚</li>
<li>åœ¨è¿‡å»ï¼Œæˆ‘ä»¬ç»å†äº†ä¸€äº›é’ˆå¯¹ç‰¹æ®Šå‘½ä»¤(ä¾‹å¦‚ï¼ŒåƒBRPOPLPUSHè¿™æ ·çš„é˜»å¡å‘½ä»¤)çš„ç½•è§bugï¼Œå¯¼è‡´åœ¨æ•°æ®åŠ è½½æ—¶æ— æ³•æ¢å¤åˆ°ä¿å­˜æ—¶çš„æ ·å­ã€‚è¿™äº›bugå¾ˆç½•è§ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨æµ‹è¯•å¥—ä»¶ä¸­è¿›è¡Œäº†æµ‹è¯•ï¼Œè‡ªåŠ¨éšæœºåˆ›é€ å¤æ‚çš„æ•°æ®é›†ï¼Œç„¶ååŠ è½½å®ƒä»¬ä»¥æ£€æŸ¥ä¸€åˆ‡æ˜¯å¦æ­£å¸¸ï¼Œä½†æ˜¯ï¼Œè¿™ç±»bugå‡ ä¹ä¸å¯èƒ½å‡ºç°åœ¨RDBæŒä¹…åŒ–ä¸­ã€‚ä¸ºäº†è¯´å¾—æ›´æ¸…æ¥šä¸€ç‚¹ï¼šRedis AOFæ˜¯é€šè¿‡é€’å¢åœ°æ›´æ–°ä¸€ä¸ªå·²ç»å­˜åœ¨çš„çŠ¶æ€ï¼ŒåƒMySQLæˆ–è€…MongoDBä¸€æ ·ï¼Œè€ŒRDBå¿«ç…§æ˜¯ä¸€æ¬¡åˆä¸€æ¬¡åœ°ä»å¤´å¼€å§‹åˆ›é€ ä¸€åˆ‡ï¼Œæ¦‚å¿µä¸Šæ›´å¥å£®ã€‚ä½†æ˜¯ï¼Œ1)è¦æ³¨æ„Redisæ¯æ¬¡é‡å†™AOFæ—¶éƒ½æ˜¯ä»¥å½“å‰æ•°æ®é›†ä¸­çš„çœŸå®æ•°æ®ä»å¤´å¼€å§‹ï¼Œç›¸å¯¹äºä¸€ç›´è¿½åŠ çš„AOFæ–‡ä»¶(æˆ–è€…ä¸€æ¬¡é‡å†™è¯»å–è€çš„AOFæ–‡ä»¶è€Œä¸æ˜¯è¯»å†…å­˜ä¸­çš„æ•°æ®)å¯¹bugçš„å…ç–«åŠ›æ›´å¼ºã€‚2)æˆ‘ä»¬è¿˜æ²¡æœ‰æ”¶åˆ°ä¸€ä»½ç”¨æˆ·åœ¨çœŸå®ä¸–ç•Œä¸­æ£€æµ‹åˆ°å´©æºƒçš„æŠ¥å‘Šã€‚</li>
</ul>
<h4 id="9-2-RDB-å¿«ç…§"><a href="#9-2-RDB-å¿«ç…§" class="headerlink" title="9.2 RDB å¿«ç…§"></a>9.2 RDB å¿«ç…§</h4><p>AOF æ–¹æ³•è¿›è¡Œæ•…éšœæ¢å¤çš„æ—¶å€™ï¼Œéœ€è¦é€ä¸€æŠŠæ“ä½œæ—¥å¿—éƒ½æ‰§è¡Œä¸€éã€‚å¦‚æœæ“ä½œæ—¥å¿—éå¸¸å¤šï¼ŒRedis å°±ä¼šæ¢å¤å¾—å¾ˆç¼“æ…¢ï¼Œå½±å“åˆ°æ­£å¸¸ä½¿ç”¨ã€‚è¿™å½“ç„¶ä¸æ˜¯ç†æƒ³çš„ç»“æœã€‚<code>RDBå¯ä»¥åœ¨å®•æœºæ—¶å®ç°å¿«é€Ÿæ¢å¤</code></p>
<p>RDB æŒä¹…åŒ–å¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ç”Ÿæˆæ•°æ®é›†çš„æ—¶é—´ç‚¹å¿«ç…§ï¼ˆpoint-in-time snapshotï¼‰</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisä¿å­˜æ•°æ®é›†å¿«ç…§åˆ°ç£ç›˜ï¼Œåä¸ºdump.rdbçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä½ å¯ä»¥è®¾ç½®è®©Redisåœ¨Nç§’å†…è‡³å°‘æœ‰Mæ¬¡æ•°æ®é›†æ”¹åŠ¨æ—¶ä¿å­˜æ•°æ®é›†ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥<strong>æ‰‹åŠ¨è°ƒç”¨SAVEæˆ–è€…BGSAVEå‘½ä»¤</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¿™ä¸ªé…ç½®ä¼šè®©Redisåœ¨æ¯ä¸ª60ç§’å†…è‡³å°‘æœ‰1000æ¬¡é”®æ”¹åŠ¨æ—¶è‡ªåŠ¨è½¬å‚¨æ•°æ®é›†åˆ°ç£ç›˜ï¼š</p>
<blockquote>
<p>save 60 1000</p>
</blockquote>
<p>è¿™ç§ç­–ç•¥è¢«ç§°ä¸ºå¿«ç…§ã€‚</p>
<p><strong>å¿«ç…§çš„è¿ä½œæ–¹å¼:</strong></p>
<p>å½“ Redis éœ€è¦ä¿å­˜ dump.rdb æ–‡ä»¶æ—¶ï¼Œ æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>Redis è°ƒç”¨ fork() ï¼ŒåŒæ—¶æ‹¥æœ‰çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ã€‚</li>
<li>å­è¿›ç¨‹å°†æ•°æ®é›†å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶ RDB æ–‡ä»¶ä¸­ã€‚</li>
<li>å½“å­è¿›ç¨‹å®Œæˆå¯¹æ–° RDB æ–‡ä»¶çš„å†™å…¥æ—¶ï¼ŒRedis ç”¨æ–° RDB æ–‡ä»¶æ›¿æ¢åŸæ¥çš„ RDB æ–‡ä»¶ï¼Œå¹¶åˆ é™¤æ—§çš„ RDB æ–‡ä»¶ã€‚</li>
</ul>
<p>è¿™ç§å·¥ä½œæ–¹å¼ä½¿å¾— Redis å¯ä»¥ä»å†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰æœºåˆ¶ä¸­è·ç›Šã€‚</p>
<p>é…ç½®æ–‡ä»¶ redis.confï¼ŒæœåŠ¡é‡æ–°å¯åŠ¨æ—¶å°±ä¼šæ¢å¤æ•°æ®</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbfilename dump.rdb #é»˜è®¤çš„æ•°æ®å¤‡ä»½æ–‡ä»¶å</span><br></pre></td></tr></table></figure>

<p>æ•°æ®å¤‡ä»½æ–‡ä»¶çš„ä½ç½®ï¼Œé»˜è®¤åœ¨å®‰è£…ç›®å½•ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG GET dir #è¾“å‡ºdump.rdbæ–‡ä»¶çš„ä½ç½®</span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶ä¸­çš„å¿«ç…§é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Unless specified otherwise, by default Redis will save the DB:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  * After 3600 seconds (an hour) <span class="keyword">if</span> at least 1 change was performed</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  * After 300 seconds (5 minutes) <span class="keyword">if</span> at least 100 changes were performed</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  * After 60 seconds <span class="keyword">if</span> at least 10000 changes were performed</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># You can set these explicitly by uncommenting the following line.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># save 3600 1 300 100 60 10000</span></span></span><br></pre></td></tr></table></figure>

<p><strong>RDB çš„ä¼˜ç‚¹:</strong></p>
<ul>
<li>RDBæ˜¯ä¸€ç§è¡¨ç¤ºæŸä¸ªå³æ—¶ç‚¹çš„Redisæ•°æ®çš„ç´§å‡‘æ–‡ä»¶ã€‚RDBæ–‡ä»¶é€‚åˆç”¨äºå¤‡ä»½ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦æ¯å°æ—¶å½’æ¡£æœ€è¿‘24å°æ—¶çš„RDBæ–‡ä»¶ï¼Œæ¯å¤©ä¿å­˜è¿‘30å¤©çš„RDBå¿«ç…§ã€‚è¿™å…è®¸ä½ å¾ˆå®¹æ˜“çš„æ¢å¤ä¸åŒç‰ˆæœ¬çš„æ•°æ®é›†ä»¥å®¹ç¾ã€‚</li>
<li>RDBéå¸¸é€‚åˆäºç¾éš¾æ¢å¤ï¼Œä½œä¸ºä¸€ä¸ªç´§å‡‘çš„å•ä¸€æ–‡ä»¶ï¼Œå¯ä»¥è¢«ä¼ è¾“åˆ°è¿œç¨‹çš„æ•°æ®ä¸­å¿ƒï¼Œæˆ–è€…æ˜¯Amazon S3(å¯èƒ½å¾—åŠ å¯†)ã€‚</li>
<li>RDBæœ€å¤§åŒ–äº†Redisçš„æ€§èƒ½ï¼Œå› ä¸ºRedisçˆ¶è¿›ç¨‹æŒä¹…åŒ–æ—¶å”¯ä¸€éœ€è¦åšçš„æ˜¯å¯åŠ¨(fork)ä¸€ä¸ªå­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹å®Œæˆæ‰€æœ‰å‰©ä½™å·¥ä½œã€‚çˆ¶è¿›ç¨‹å®ä¾‹ä¸éœ€è¦æ‰§è¡Œåƒç£ç›˜IOè¿™æ ·çš„æ“ä½œã€‚</li>
<li>RDBåœ¨é‡å¯ä¿å­˜äº†å¤§æ•°æ®é›†çš„å®ä¾‹æ—¶æ¯”AOFè¦å¿«ã€‚</li>
</ul>
<p><strong>RDB çš„ç¼ºç‚¹</strong></p>
<ul>
<li>å½“ä½ éœ€è¦åœ¨Redisåœæ­¢å·¥ä½œ(ä¾‹å¦‚åœç”µ)æ—¶æœ€å°åŒ–æ•°æ®ä¸¢å¤±ï¼ŒRDBå¯èƒ½ä¸å¤ªå¥½ã€‚ä½ å¯ä»¥é…ç½®ä¸åŒçš„ä¿å­˜ç‚¹(save point)æ¥ä¿å­˜RDBæ–‡ä»¶(ä¾‹å¦‚ï¼Œ5åˆ†é’Ÿä¹‹åè‡³å°‘å¯¹æ•°æ®é›†100æ¬¡å†™ä¹‹åï¼Œä½†æ˜¯ä½ å¯ä»¥æœ‰å¤šä¸ªä¿å­˜ç‚¹)ã€‚ç„¶è€Œï¼Œä½ é€šå¸¸æ¯éš”5åˆ†é’Ÿæˆ–æ›´ä¹…åˆ›å»ºä¸€ä¸ªRDBå¿«ç…§ï¼Œæ‰€ä»¥ä¸€æ—¦Rediså› ä¸ºä»»ä½•åŸå› æ²¡æœ‰æ­£ç¡®å…³é—­è€Œåœæ­¢å·¥ä½œï¼Œä½ å°±å¾—åšå¥½æœ€è¿‘å‡ åˆ†é’Ÿæ•°æ®ä¸¢å¤±çš„å‡†å¤‡äº†ã€‚</li>
<li>RDBéœ€è¦ç»å¸¸è°ƒç”¨fork()å­è¿›ç¨‹æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚å¦‚æœæ•°æ®é›†å¾ˆå¤§çš„è¯ï¼Œfork()æ¯”è¾ƒè€—æ—¶ï¼Œç»“æœå°±æ˜¯ï¼Œå½“æ•°æ®é›†éå¸¸å¤§å¹¶ä¸”CPUæ€§èƒ½ä¸å¤Ÿå¼ºå¤§çš„è¯ï¼ŒRedisä¼šåœæ­¢æœåŠ¡å®¢æˆ·ç«¯å‡ æ¯«ç§’ç”šè‡³ä¸€ç§’ã€‚AOFä¹Ÿéœ€è¦fork()ï¼Œä½†æ˜¯ä½ å¯ä»¥è°ƒæ•´å¤šä¹…é¢‘ç‡é‡å†™æ—¥å¿—è€Œä¸ä¼šæœ‰æŸ(trade-off)æŒä¹…æ€§(durability)ã€‚</li>
</ul>
<p>RDB è®°å½•çš„æ˜¯æŸä¸€æ—¶åˆ»çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯æ“ä½œ</p>
<p>æˆ‘ä»¬è¿˜è¦è€ƒè™‘ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š</p>
<ul>
<li>å¯¹å“ªäº›æ•°æ®åšå¿«ç…§ï¼Ÿè¿™å…³ç³»åˆ°å¿«ç…§çš„æ‰§è¡Œæ•ˆç‡é—®é¢˜ï¼›</li>
<li>åšå¿«ç…§æ—¶ï¼Œæ•°æ®è¿˜èƒ½è¢«å¢åˆ æ”¹å—ï¼Ÿè¿™å…³ç³»åˆ° Redis æ˜¯å¦è¢«é˜»å¡ï¼Œèƒ½å¦åŒæ—¶æ­£å¸¸å¤„ç†è¯·æ±‚ã€‚</li>
</ul>
<p><strong>ç»™å“ªäº›å†…å­˜æ•°æ®åšå¿«ç…§ï¼Ÿ</strong></p>
<p>Redis çš„æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†æä¾›æ‰€æœ‰æ•°æ®çš„å¯é æ€§ä¿è¯ï¼Œå®ƒæ‰§è¡Œçš„æ˜¯<code>å…¨é‡å¿«ç…§</code>ï¼Œä¹Ÿå°±<br>æ˜¯è¯´ï¼ŒæŠŠå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è®°å½•åˆ°ç£ç›˜ä¸­.<br>å¯¹äº Redis è€Œè¨€ï¼Œå®ƒçš„å•çº¿ç¨‹æ¨¡å‹å°±å†³å®šäº†ï¼Œæˆ‘ä»¬è¦å°½é‡é¿å…æ‰€æœ‰ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„æ“ä½œï¼Œ</p>
<p>Redis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ save å’Œ bgsaveã€‚</p>
<ul>
<li>saveï¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¼šå¯¼è‡´é˜»å¡ï¼›</li>
<li>bgsaveï¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œä¸“é—¨ç”¨äºå†™å…¥ RDB æ–‡ä»¶ï¼Œé¿å…äº†ä¸»çº¿ç¨‹çš„é˜»å¡ï¼Œè¿™ä¹Ÿæ˜¯Redis RDB æ–‡ä»¶ç”Ÿæˆçš„é»˜è®¤é…ç½®</li>
</ul>
<p><strong>å¿«ç…§æ—¶æ•°æ®èƒ½ä¿®æ”¹å—?</strong></p>
<p>ä¸¾ä¸ªä¾‹å­ã€‚æˆ‘ä»¬åœ¨æ—¶åˆ» t ç»™å†…å­˜åšå¿«ç…§ï¼Œå‡è®¾å†…å­˜æ•°æ®é‡æ˜¯ 4GBï¼Œç£ç›˜çš„å†™å…¥å¸¦å®½æ˜¯0.2GB&#x2F;sï¼Œç®€å•æ¥è¯´ï¼Œè‡³å°‘éœ€è¦ 20sï¼ˆ4&#x2F;0.2 &#x3D; 20ï¼‰æ‰èƒ½åšå®Œã€‚å¦‚æœåœ¨æ—¶åˆ» t+5s æ—¶ï¼Œä¸€ä¸ª<code>è¿˜æ²¡æœ‰è¢«å†™å…¥ç£ç›˜</code>çš„å†…å­˜æ•°æ® Aï¼Œè¢«ä¿®æ”¹æˆäº† Aâ€™ï¼Œé‚£ä¹ˆå°±ä¼šç ´åå¿«ç…§çš„å®Œæ•´æ€§ï¼Œå› ä¸ºAâ€™ä¸æ˜¯æ—¶åˆ» t æ—¶çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œå’Œæ‹ç…§ç±»ä¼¼ï¼Œæˆ‘ä»¬åœ¨åšå¿«ç…§æ—¶ä¹Ÿä¸å¸Œæœ›æ•°æ®â€œåŠ¨â€ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è¢«ä¿®æ”¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¿«ç…§æ‰§è¡ŒæœŸé—´æ•°æ®ä¸èƒ½è¢«ä¿®æ”¹ï¼ŒRedis å°±ä¸èƒ½å¤„ç†å¯¹è¿™äº›æ•°æ®çš„<code>å†™æ“ä½œ</code>ï¼Œé‚£æ— ç–‘å°±ä¼šç»™ä¸šåŠ¡æœåŠ¡é€ æˆå·¨å¤§çš„å½±å“ã€‚</p>
<p>ä¸ºäº†ä¿æŒå†™æ“ä½œï¼ŒRedis å°±ä¼šå€ŸåŠ©æ“ä½œç³»ç»Ÿæä¾›çš„<strong>å†™æ—¶å¤åˆ¶æŠ€æœ¯</strong>ï¼ˆCopy-On-Write, COWï¼‰ï¼Œåœ¨æ‰§è¡Œå¿«ç…§çš„åŒæ—¶ï¼Œæ­£å¸¸å¤„ç†å†™æ“ä½œã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œbgsave å­è¿›ç¨‹æ˜¯ç”±ä¸»çº¿ç¨‹ fork ç”Ÿæˆçš„ï¼Œå¯ä»¥å…±äº«ä¸»çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜æ•°æ®ã€‚bgsave å­è¿›ç¨‹è¿è¡Œåï¼Œå¼€å§‹è¯»å–ä¸»çº¿ç¨‹çš„å†…å­˜æ•°æ®ï¼Œå¹¶æŠŠå®ƒä»¬å†™å…¥ RDB æ–‡ä»¶ã€‚</p>
<p>æ­¤æ—¶ï¼Œå¦‚æœä¸»çº¿ç¨‹å¯¹è¿™äº›æ•°æ®ä¹Ÿéƒ½æ˜¯è¯»æ“ä½œï¼ˆä¾‹å¦‚å›¾ä¸­çš„é”®å€¼å¯¹ Aï¼‰ï¼Œé‚£ä¹ˆï¼Œä¸»çº¿ç¨‹å’Œbgsave å­è¿›ç¨‹ç›¸äº’ä¸å½±å“ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸»çº¿ç¨‹è¦ä¿®æ”¹ä¸€å—æ•°æ®ï¼ˆä¾‹å¦‚å›¾ä¸­çš„é”®å€¼å¯¹ Cï¼Œè¿˜æœªå†™ç£ç›˜ï¼‰ï¼Œé‚£ä¹ˆï¼Œè¿™å—æ•°æ®å°±ä¼šè¢«å¤åˆ¶ä¸€ä»½ï¼Œç”Ÿæˆè¯¥æ•°æ®çš„å‰¯æœ¬ã€‚ç„¶åï¼Œbgsave å­è¿›ç¨‹ä¼šæŠŠè¿™ä¸ªå‰¯æœ¬æ•°æ®å†™å…¥ RDB æ–‡ä»¶ï¼Œè€Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»çº¿ç¨‹ä»ç„¶å¯ä»¥ç›´æ¥ä¿®æ”¹åŸæ¥çš„æ•°æ®ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/YuChaoM/images/OS/image-20220912162822300.png" alt="image-20220912162822300"></p>
<p><strong>å¤šä¹…åšä¸€æ¬¡å¿«ç…§ï¼Ÿ</strong></p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å…ˆåœ¨ T0 æ—¶åˆ»åšäº†ä¸€æ¬¡å¿«ç…§ï¼Œç„¶ååˆåœ¨ T0+t æ—¶åˆ»åšäº†ä¸€æ¬¡å¿«ç…§ï¼Œåœ¨è¿™æœŸé—´ï¼Œæ•°æ®å— 5 å’Œ 9 è¢«ä¿®æ”¹äº†ã€‚å¦‚æœåœ¨ t è¿™æ®µæ—¶é—´å†…ï¼Œæœºå™¨å®•æœºäº†ï¼Œé‚£ä¹ˆï¼Œåªèƒ½æŒ‰ç…§ T0 æ—¶åˆ»çš„å¿«ç…§è¿›è¡Œæ¢å¤ã€‚æ­¤æ—¶ï¼Œæ•°æ®å— 5 å’Œ 9 çš„ä¿®æ”¹å€¼å› ä¸ºæ²¡æœ‰å¿«ç…§è®°å½•ï¼Œå°±æ— æ³•æ¢å¤äº†ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/YuChaoM/images/OS/image-20220912163132682.png" alt="image-20220912163132682"></p>
<p>å¦‚æœæ¯ç§’åšä¸€æ¬¡å¿«ç…§ï¼Œ<code>è™½ç„¶ bgsave æ‰§è¡Œæ—¶ä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œå¦‚æœé¢‘ç¹åœ°æ‰§è¡Œå…¨é‡å¿«ç…§ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸¤æ–¹é¢çš„å¼€é”€ã€‚</code></p>
<p>ä¸€æ–¹é¢ï¼Œé¢‘ç¹å°†å…¨é‡æ•°æ®å†™å…¥ç£ç›˜ï¼Œä¼šç»™ç£ç›˜å¸¦æ¥å¾ˆå¤§å‹åŠ›ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œbgsave å­è¿›ç¨‹éœ€è¦é€šè¿‡ fork æ“ä½œä»ä¸»çº¿ç¨‹åˆ›å»ºå‡ºæ¥ã€‚è™½ç„¶ï¼Œå­è¿›ç¨‹åœ¨åˆ›å»ºåä¸ä¼šå†é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œfork è¿™ä¸ªåˆ›å»ºè¿‡ç¨‹æœ¬èº«ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œä¸”ä¸»çº¿ç¨‹çš„å†…å­˜è¶Šå¤§ï¼Œé˜»å¡æ—¶é—´è¶Šé•¿ã€‚å¦‚æœé¢‘ç¹ fork å‡º bgsave å­è¿›ç¨‹ï¼Œè¿™å°±ä¼šé¢‘ç¹é˜»å¡ä¸»çº¿ç¨‹äº†ã€‚</p>
<p>æœ‰ä»€ä¹ˆæ–¹æ³•æ—¢èƒ½åˆ©ç”¨ RDB çš„å¿«é€Ÿæ¢å¤ï¼Œåˆèƒ½ä»¥è¾ƒå°çš„å¼€é”€åšåˆ°å°½é‡å°‘ä¸¢æ•°æ®å‘¢ï¼Ÿ</p>
<h5 id="æ··åˆä½¿ç”¨-AOF-æ—¥å¿—å’Œå†…å­˜å¿«ç…§"><a href="#æ··åˆä½¿ç”¨-AOF-æ—¥å¿—å’Œå†…å­˜å¿«ç…§" class="headerlink" title="æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§"></a>æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§</h5><p>Redis 4.0 ä¸­æå‡ºäº†ä¸€ä¸ª<strong>æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§</strong>çš„æ–¹æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œåœ¨ä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨ AOF æ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œã€‚</p>
<p>T1 å’Œ T2 æ—¶åˆ»çš„ä¿®æ”¹ï¼Œç”¨ AOF æ—¥å¿—è®°å½•ï¼Œç­‰åˆ°ç¬¬äºŒæ¬¡åšå…¨é‡å¿«ç…§æ—¶ï¼Œå°±å¯ä»¥æ¸…ç©º AOF æ—¥å¿—ï¼Œå› ä¸ºæ­¤æ—¶çš„ä¿®æ”¹éƒ½å·²ç»è®°å½•åˆ°å¿«ç…§ä¸­äº†ï¼Œæ¢å¤æ—¶å°±ä¸å†ç”¨æ—¥å¿—äº†ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/YuChaoM/images/OS/image-20220912163546708.png" alt="image-20220912163546708"></p>
<blockquote>
<p>å¼€å¯ï¼šæ··åˆæŒä¹…åŒ–çš„é…ç½®å‚æ•°ä¸º aof-use-rdb-preambleï¼Œé…ç½®ä¸º yes æ—¶å¼€å¯æ··åˆæŒä¹…åŒ–ï¼Œåœ¨ redis 4 åˆšå¼•å…¥æ—¶ï¼Œé»˜è®¤æ˜¯å…³é—­æ··åˆæŒä¹…åŒ–çš„ï¼Œä½†æ˜¯åœ¨ <strong>redis 5 ä¸­é»˜è®¤å·²ç»æ‰“å¼€äº†</strong>ã€‚</p>
</blockquote>
<h4 id="9-3-å¦‚ä½•ç”±RDBæŒä¹…åŒ–è½¬æ¢åˆ°AOFæŒä¹…åŒ–ï¼Ÿ"><a href="#9-3-å¦‚ä½•ç”±RDBæŒä¹…åŒ–è½¬æ¢åˆ°AOFæŒä¹…åŒ–ï¼Ÿ" class="headerlink" title="9.3 å¦‚ä½•ç”±RDBæŒä¹…åŒ–è½¬æ¢åˆ°AOFæŒä¹…åŒ–ï¼Ÿ"></a>9.3 å¦‚ä½•ç”±RDBæŒä¹…åŒ–è½¬æ¢åˆ°AOFæŒä¹…åŒ–ï¼Ÿ</h4><p>Redis 2.0 å’Œ Redis 2.2 å¤„ç†æµç¨‹ä¸ä¸€æ ·ï¼Œå¯ä»¥å¾ˆç®€å•çŒœæµ‹åˆ° Redis 2.2 å¤„ç†æµç¨‹æ›´ç®€å•ï¼Œå¹¶ä¸”ä¸éœ€è¦é‡å¯ã€‚</p>
<p><strong>Redis &gt;&#x3D;2.2 æ—¶</strong></p>
<ul>
<li>åˆ›å»ºæœ€è¿‘çš„RDBæ–‡ä»¶çš„å¤‡ä»½ã€‚</li>
<li>å°†å¤‡ä»½ä¿å­˜åœ¨å®‰å…¨çš„ä½ç½®ã€‚</li>
<li>å‘èµ·å¦‚ä¸‹å‘½ä»¤ã€‚</li>
<li>$redis-cli config set appendonly yesã€‚</li>
<li>$redis-cli config set save â€œâ€ã€‚</li>
<li>ç¡®è®¤æ•°æ®åº“åŒ…å«ç›¸åŒçš„keysã€‚</li>
<li>ç¡®è®¤writeæ“ä½œè¢«æ­£ç¡®è¿½åŠ åˆ°äº†AOFæ–‡ä»¶ã€‚</li>
</ul>
<p>ç¬¬ä¸€ä¸ªCONFIGå‘½ä»¤å¼€å¯AOFã€‚Redisä¼šé˜»å¡ä»¥ç”Ÿæˆåˆå§‹è½¬å‚¨æ–‡ä»¶ï¼Œç„¶åæ‰“å¼€æ–‡ä»¶å‡†å¤‡å†™ï¼Œå¼€å§‹è¿½åŠ å†™æ“ä½œã€‚</p>
<p>ç¬¬äºŒä¸ªCONFIGå‘½ä»¤ç”¨äºå…³é—­å¿«ç…§æŒä¹…åŒ–ã€‚è¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä½ æƒ³åŒæ—¶å¼€å¯è¿™ä¸¤ç§æŒä¹…åŒ–æ–¹æ³•ã€‚</p>
<p><strong>é‡è¦ï¼š</strong>è®°å¾—ç¼–è¾‘ä½ çš„redis.confæ–‡ä»¶æ¥å¼€å¯AOFï¼Œå¦åˆ™å½“ä½ é‡å¯æœåŠ¡å™¨æ—¶ï¼Œä½ çš„é…ç½®ä¿®æ”¹å°†ä¼šä¸¢å¤±ï¼ŒæœåŠ¡å™¨åˆä¼šä½¿ç”¨æ—§çš„é…ç½®ã€‚</p>
<h3 id="10ã€ä¸»ä»å¤åˆ¶"><a href="#10ã€ä¸»ä»å¤åˆ¶" class="headerlink" title="10ã€ä¸»ä»å¤åˆ¶"></a>10ã€ä¸»ä»å¤åˆ¶</h3><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903943764443149">æ­å»ºå‚è€ƒ</a></p>
<p>Redis å…·æœ‰é«˜å¯é æ€§ï¼šä¸€æ˜¯æ•°æ®å°½é‡å°‘ä¸¢å¤±ï¼ŒäºŒæ˜¯æœåŠ¡å°½é‡å°‘ä¸­æ–­ã€‚AOF å’Œ RDB ä¿è¯äº†å‰è€…ï¼Œè€Œå¯¹äºåè€…ï¼ŒRedis çš„åšæ³•å°±æ˜¯å¢åŠ å‰¯æœ¬å†—ä½™é‡ï¼Œå°†ä¸€ä»½æ•°æ®åŒæ—¶ä¿å­˜åœ¨å¤šä¸ªå®ä¾‹ä¸Šã€‚</p>
<p>å®é™…ä¸Šï¼ŒRedis æä¾›äº†ä¸»ä»åº“æ¨¡å¼ï¼Œä»¥ä¿è¯æ•°æ®å‰¯æœ¬çš„ä¸€è‡´ï¼Œä¸»ä»åº“ä¹‹é—´é‡‡ç”¨çš„æ˜¯è¯»å†™åˆ†ç¦»çš„æ–¹å¼ã€‚</p>
<ul>
<li>è¯»æ“ä½œï¼šä¸»åº“ã€ä»åº“éƒ½å¯ä»¥æ¥æ”¶ï¼›</li>
<li>å†™æ“ä½œï¼šé¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œç„¶åï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“ã€‚</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/YuChaoM/images/OS/image-20220912195034424.png" alt="image-20220912195034424"></p>
<p>å¦‚æœåœ¨ä¸Šå›¾ä¸­ï¼Œä¸ç®¡æ˜¯ä¸»åº“è¿˜æ˜¯ä»åº“ï¼Œéƒ½èƒ½æ¥æ”¶å®¢æˆ·ç«¯çš„å†™æ“ä½œï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªç›´æ¥çš„é—®é¢˜å°±æ˜¯ï¼šå¦‚æœå®¢æˆ·ç«¯å¯¹åŒä¸€ä¸ªæ•°æ®ï¼ˆä¾‹å¦‚ k1ï¼‰å‰åä¿®æ”¹äº†ä¸‰æ¬¡ï¼Œæ¯ä¸€æ¬¡çš„ä¿®æ”¹è¯·æ±‚éƒ½å‘é€åˆ°ä¸åŒçš„å®ä¾‹ä¸Šï¼Œåœ¨ä¸åŒçš„å®ä¾‹ä¸Šæ‰§è¡Œï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ•°æ®åœ¨è¿™ä¸‰ä¸ªå®ä¾‹ä¸Šçš„å‰¯æœ¬å°±ä¸ä¸€è‡´äº†ï¼ˆåˆ†åˆ«æ˜¯ v1ã€v2 å’Œ v3ï¼‰</p>
<p>å¦‚æœæˆ‘ä»¬éè¦ä¿æŒè¿™ä¸ªæ•°æ®åœ¨ä¸‰ä¸ªå®ä¾‹ä¸Šä¸€è‡´ï¼Œå°±è¦æ¶‰åŠåˆ°åŠ é”ã€å®ä¾‹é—´åå•†æ˜¯å¦å®Œæˆä¿®æ”¹ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œä½†è¿™ä¼šå¸¦æ¥å·¨é¢çš„å¼€é”€</p>
<p><strong>ä¸»ä»åº“é—´å¦‚ä½•è¿›è¡Œç¬¬ä¸€æ¬¡åŒæ­¥ï¼Ÿ</strong></p>
<p>å½“æˆ‘ä»¬å¯åŠ¨å¤šä¸ª Redis å®ä¾‹çš„æ—¶å€™ï¼Œå®ƒä»¬ç›¸äº’ä¹‹é—´å°±å¯ä»¥é€šè¿‡ replicaofï¼ˆRedis 5.0 ä¹‹å‰ä½¿ç”¨ slaveofï¼‰å‘½ä»¤å½¢æˆä¸»åº“å’Œä»åº“çš„å…³ç³»ï¼Œä¹‹åä¼šæŒ‰ç…§ä¸‰ä¸ªé˜¶æ®µå®Œæˆæ•°æ®çš„ç¬¬ä¸€æ¬¡åŒæ­¥ã€‚</p>
<p>ä¾‹å¦‚ï¼Œç°åœ¨æœ‰å®ä¾‹ 1ï¼ˆipï¼š172.16.19.3ï¼‰å’Œå®ä¾‹ 2ï¼ˆipï¼š172.16.19.5ï¼‰ï¼Œæˆ‘ä»¬åœ¨å®ä¾‹ 2 ä¸Šæ‰§è¡Œä»¥ä¸‹è¿™ä¸ªå‘½ä»¤åï¼Œå®ä¾‹ 2 å°±å˜æˆäº†å®ä¾‹ 1 çš„ä»åº“ï¼Œå¹¶ä»å®ä¾‹ 1 ä¸Šå¤åˆ¶æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicaof 172.16.19.3 6379</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/YuChaoM/images/OS/image-20220912195509697.png" alt="image-20220912195509697"></p>
<p>ä¸»ä»çº§è”æ¨¡å¼åˆ†æ‹…å…¨é‡å¤åˆ¶æ—¶çš„ä¸»åº“å‹åŠ›</p>
<p>è¿™å°±æ˜¯â€œä¸» - ä» - ä»â€æ¨¡å¼,æˆ‘ä»¬å¯ä»¥é€šè¿‡â€œä¸» - ä» - ä»â€æ¨¡å¼å°†ä¸»åº“ç”Ÿæˆ RDB å’Œä¼ è¾“ RDB çš„å‹åŠ›ï¼Œä»¥çº§è”çš„æ–¹å¼åˆ†æ•£åˆ°ä»åº“ä¸Š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/YuChaoM/images/OS/image-20220912200657427.png" alt="image-20220912200657427"></p>
<p>æˆ‘ä»¬äº†è§£äº†ä¸»ä»åº“é—´é€šè¿‡å…¨é‡å¤åˆ¶å®ç°æ•°æ®åŒæ­¥çš„è¿‡ç¨‹ï¼Œä»¥åŠé€šè¿‡â€œä¸» -ä» - ä»â€æ¨¡å¼åˆ†æ‹…ä¸»åº“å‹åŠ›çš„æ–¹å¼ã€‚é‚£ä¹ˆï¼Œä¸€æ—¦ä¸»ä»åº“å®Œæˆäº†å…¨é‡å¤åˆ¶ï¼Œå®ƒä»¬ä¹‹é—´å°±ä¼šä¸€ç›´ç»´æŠ¤ä¸€ä¸ªç½‘ç»œè¿æ¥ï¼Œä¸»åº“ä¼šé€šè¿‡è¿™ä¸ªè¿æ¥å°†åç»­é™†ç»­æ”¶åˆ°çš„å‘½ä»¤æ“ä½œå†åŒæ­¥ç»™ä»åº“ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸º<strong>åŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­</strong>ï¼Œå¯ä»¥é¿å…é¢‘ç¹å»ºç«‹è¿æ¥çš„å¼€é”€ã€‚å¦‚æœç½‘ç»œæ–­è¿ï¼Œä¸»ä»åº“ä¹‹é—´å°±æ— æ³•è¿›è¡Œå‘½ä»¤ä¼ æ’­äº†ï¼Œä»åº“çš„æ•°æ®è‡ªç„¶ä¹Ÿå°±æ²¡åŠæ³•å’Œä¸»åº“ä¿æŒä¸€è‡´äº†ï¼Œå®¢æˆ·ç«¯å°±å¯èƒ½ä»ä»åº“è¯»åˆ°æ—§æ•°æ®ã€‚</p>
<p><strong>ä¸»ä»åº“é—´ç½‘ç»œæ–­äº†æ€ä¹ˆåŠï¼Ÿ</strong></p>
<p>åœ¨ Redis 2.8 ä¹‹å‰ï¼Œå¦‚æœä¸»ä»åº“åœ¨å‘½ä»¤ä¼ æ’­æ—¶å‡ºç°äº†ç½‘ç»œé—ªæ–­ï¼Œé‚£ä¹ˆï¼Œä»åº“å°±ä¼šå’Œä¸»åº“é‡æ–°è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œå¼€é”€éå¸¸å¤§</p>
<p>ä» Redis 2.8 å¼€å§‹ï¼Œç½‘ç»œæ–­äº†ä¹‹åï¼Œä¸»ä»åº“ä¼šé‡‡ç”¨å¢é‡å¤åˆ¶çš„æ–¹å¼ç»§ç»­åŒæ­¥ã€‚å¬åå­—å¤§æ¦‚å°±å¯ä»¥çŒœåˆ°å®ƒå’Œå…¨é‡å¤åˆ¶çš„ä¸åŒï¼š<code>å…¨é‡å¤åˆ¶æ˜¯åŒæ­¥æ‰€æœ‰æ•°æ®ï¼Œè€Œå¢é‡å¤åˆ¶åªä¼šæŠŠä¸»ä»åº“ç½‘ç»œæ–­è¿æœŸé—´ä¸»åº“æ”¶åˆ°çš„å‘½ä»¤ï¼ŒåŒæ­¥ç»™ä»åº“ã€‚</code></p>
<p>é‚£ä¹ˆï¼Œå¢é‡å¤åˆ¶æ—¶ï¼Œä¸»ä»åº“ä¹‹é—´å…·ä½“æ˜¯æ€ä¹ˆä¿æŒåŒæ­¥çš„å‘¢ï¼Ÿè¿™é‡Œçš„å¥¥å¦™å°±åœ¨äº<code>repl_backlog_buffer</code> è¿™ä¸ªç¼“å†²åŒºã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å®ƒæ˜¯å¦‚ä½•ç”¨äºå¢é‡å‘½ä»¤çš„åŒæ­¥çš„ã€‚</p>
<p>å½“ä¸»ä»åº“æ–­è¿åï¼Œä¸»åº“ä¼šæŠŠæ–­è¿æœŸé—´æ”¶åˆ°çš„å†™æ“ä½œå‘½ä»¤ï¼Œ<code>å†™å…¥ replication bufferï¼ŒåŒæ—¶ä¹Ÿä¼šæŠŠè¿™äº›æ“ä½œå‘½ä»¤ä¹Ÿå†™å…¥ repl_backlog_buffer è¿™ä¸ªç¼“å†²åŒº</code>ã€‚</p>
<p>repl_backlog_buffer æ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œ<strong>ä¸»åº“ä¼šè®°å½•è‡ªå·±å†™åˆ°çš„ä½ç½®ï¼Œä»åº“åˆ™ä¼šè®°å½•è‡ªå·±å·²ç»è¯»åˆ°çš„ä½ç½®ã€‚</strong></p>
<p>åˆšå¼€å§‹çš„æ—¶å€™ï¼Œä¸»åº“å’Œä»åº“çš„å†™è¯»ä½ç½®åœ¨ä¸€èµ·ï¼Œè¿™ç®—æ˜¯å®ƒä»¬çš„èµ·å§‹ä½ç½®ã€‚éšç€ä¸»åº“ä¸æ–­æ¥æ”¶æ–°çš„å†™æ“ä½œï¼Œå®ƒåœ¨ç¼“å†²åŒºä¸­çš„å†™ä½ç½®ä¼šé€æ­¥åç¦»èµ·å§‹ä½ç½®ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨åç§»é‡æ¥è¡¡é‡è¿™ä¸ªåç§»è·ç¦»çš„å¤§å°ï¼Œå¯¹ä¸»åº“æ¥è¯´ï¼Œå¯¹åº”çš„åç§»é‡å°±æ˜¯ master_repl_offsetã€‚ä¸»åº“æ¥æ”¶çš„æ–°å†™æ“ä½œè¶Šå¤šï¼Œè¿™ä¸ªå€¼å°±ä¼šè¶Šå¤§ã€‚</p>
<p>åŒæ ·ï¼Œä»åº“åœ¨å¤åˆ¶å®Œå†™æ“ä½œå‘½ä»¤åï¼Œå®ƒåœ¨ç¼“å†²åŒºä¸­çš„è¯»ä½ç½®ä¹Ÿå¼€å§‹é€æ­¥åç§»åˆšæ‰çš„èµ·å§‹ä½ç½®ï¼Œæ­¤æ—¶ï¼Œä»åº“å·²å¤åˆ¶çš„åç§»é‡ slave_repl_offset ä¹Ÿåœ¨ä¸æ–­å¢åŠ ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªåç§»é‡åŸºæœ¬ç›¸ç­‰ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/YuChaoM/images/OS/image-20220912201550054.png" alt="image-20220912201550054"></p>
<p>ä¸»ä»åº“çš„è¿æ¥æ¢å¤ä¹‹åï¼Œä»åº“é¦–å…ˆä¼šç»™ä¸»åº“å‘é€ psync å‘½ä»¤ï¼Œå¹¶æŠŠè‡ªå·±å½“å‰çš„slave_repl_offset å‘ç»™ä¸»åº“ï¼Œä¸»åº“ä¼šåˆ¤æ–­è‡ªå·±çš„ master_repl_offset å’Œ slave_repl_offsetä¹‹é—´çš„å·®è·ã€‚</p>
<p>åœ¨ç½‘ç»œæ–­è¿é˜¶æ®µï¼Œä¸»åº“å¯èƒ½ä¼šæ”¶åˆ°æ–°çš„å†™æ“ä½œå‘½ä»¤ï¼Œæ‰€ä»¥ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œmaster_repl_offsetä¼šå¤§äº slave_repl_offsetã€‚æ­¤æ—¶ï¼Œä¸»åº“åªç”¨æŠŠ master_repl_offset å’Œ slave_repl_offsetä¹‹é—´çš„å‘½ä»¤æ“ä½œåŒæ­¥ç»™ä»åº“å°±è¡Œã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/YuChaoM/images/OS/image-20220912201646405.png" alt="image-20220912201646405"></p>
<p>å› ä¸º repl_backlog_buffer æ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œæ‰€ä»¥åœ¨ç¼“å†²åŒºå†™æ»¡åï¼Œä¸»åº“ä¼šç»§ç»­å†™å…¥ï¼Œæ­¤æ—¶ï¼Œå°±ä¼šè¦†ç›–æ‰ä¹‹å‰å†™å…¥çš„æ“ä½œã€‚å¦‚æœä»åº“çš„è¯»å–é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´ä»åº“è¿˜æœªè¯»å–çš„æ“ä½œè¢«ä¸»åº“æ–°å†™çš„æ“ä½œè¦†ç›–äº†ï¼Œè¿™ä¼šå¯¼è‡´ä¸»ä»åº“é—´çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´ repl_backlog_size è¿™ä¸ªå‚æ•°ã€‚è¿™ä¸ªå‚æ•°å’Œæ‰€éœ€çš„ç¼“å†²ç©ºé—´å¤§å°æœ‰å…³ã€‚ç¼“å†²ç©ºé—´çš„è®¡ç®—å…¬å¼æ˜¯ï¼šç¼“å†²ç©ºé—´å¤§å° &#x3D; ä¸»åº“å†™å…¥å‘½ä»¤é€Ÿåº¦ * æ“ä½œå¤§å° - ä¸»ä»åº“é—´ç½‘ç»œä¼ è¾“å‘½ä»¤é€Ÿåº¦ * æ“ä½œå¤§å°ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè€ƒè™‘åˆ°å¯èƒ½å­˜åœ¨ä¸€äº›çªå‘çš„è¯·æ±‚å‹åŠ›ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æŠŠè¿™ä¸ªç¼“å†²ç©ºé—´æ‰©å¤§ä¸€å€ï¼Œå³repl_backlog_size &#x3D; ç¼“å†²ç©ºé—´å¤§å° * 2ï¼Œè¿™ä¹Ÿå°±æ˜¯ repl_backlog_size çš„æœ€ç»ˆå€¼ã€‚</p>
<h3 id="11ã€å“¨å…µ"><a href="#11ã€å“¨å…µ" class="headerlink" title="11ã€å“¨å…µ"></a>11ã€å“¨å…µ</h3><h3 id="12ã€é›†ç¾¤"><a href="#12ã€é›†ç¾¤" class="headerlink" title="12ã€é›†ç¾¤"></a>12ã€é›†ç¾¤</h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="http://example.com">AXDecap</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2022/11/02/Redis/">http://example.com/2022/11/02/Redis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://gcore.jsdelivr.net/gh/AXDecap/imagehost/img/mmexport1652792137012.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/AXDecap/imagehost/img/1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">AXDecap</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">1</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/AXDecap"><i class="fab fa-github"></i><span>authorï¼šAXDecap</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/AXDecap" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:overu2soon@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis"><span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85"><span class="toc-text">1ã€å®‰è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE"><span class="toc-text">2ã€é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%B8%B8%E7%94%A8%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">3ã€å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E5%91%BD%E4%BB%A4"><span class="toc-text">2.1å‘½ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E9%94%AE"><span class="toc-text">2.2é”®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">2.1å­—ç¬¦ä¸²</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2Hash"><span class="toc-text">2.2Hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E5%88%97%E8%A1%A8list"><span class="toc-text">2.3åˆ—è¡¨list</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%E9%9B%86%E5%90%88set"><span class="toc-text">2.4é›†åˆset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88sorted-set"><span class="toc-text">2.5æœ‰åºé›†åˆsorted set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-%E6%96%B0%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">2.6 æ–°æ•°æ®ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Bitmaps"><span class="toc-text">Bitmaps</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Redis-HyperLogLog"><span class="toc-text">Redis HyperLogLog</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#GEO"><span class="toc-text">GEO</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="toc-text">4ã€å‘å¸ƒè®¢é˜…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81Java-%E4%BD%BF%E7%94%A8-Redis-Jedis"><span class="toc-text">5ã€Java ä½¿ç”¨ Redis(Jedis)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81Redis%E4%B8%8ESpring-Boot%E6%95%B4%E5%90%88"><span class="toc-text">6ã€Redisä¸Spring Bootæ•´åˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81Redis%E4%BA%8B%E5%8A%A1"><span class="toc-text">7ã€Redisäº‹åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81Redis%E8%84%9A%E6%9C%AC-Lua"><span class="toc-text">8ã€Redisè„šæœ¬(Lua)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">9ã€æŒä¹…åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-AOF"><span class="toc-text">9.1 AOF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-RDB-%E5%BF%AB%E7%85%A7"><span class="toc-text">9.2 RDB å¿«ç…§</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E4%BD%BF%E7%94%A8-AOF-%E6%97%A5%E5%BF%97%E5%92%8C%E5%86%85%E5%AD%98%E5%BF%AB%E7%85%A7"><span class="toc-text">æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-%E5%A6%82%E4%BD%95%E7%94%B1RDB%E6%8C%81%E4%B9%85%E5%8C%96%E8%BD%AC%E6%8D%A2%E5%88%B0AOF%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%9F"><span class="toc-text">9.3 å¦‚ä½•ç”±RDBæŒä¹…åŒ–è½¬æ¢åˆ°AOFæŒä¹…åŒ–ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">10ã€ä¸»ä»å¤åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81%E5%93%A8%E5%85%B5"><span class="toc-text">11ã€å“¨å…µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81%E9%9B%86%E7%BE%A4"><span class="toc-text">12ã€é›†ç¾¤</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By AXDecap</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">ç¹</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="30" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>